<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.34: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Darwin EKRs-MacBook-Pro.local 13.4.0 Darwin Kernel Version 13.4.0: Wed Dec 17 19:05:52 PST 2014; root:xnu-2422.115.10~1/RELEASE_X86_64 x86_64 --> 
<!-- Using awk: /opt/local/bin/gawk: GNU Awk 4.1.1, API: 1.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 2.8.1 --> 
<!-- Using wdiff: /opt/local/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: draft-ietf-tls-tls13-orig.txt - draft-ietf-tls-tls13.txt</title> 
  <style type="text/css"> 
    body    { margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;draft-ietf-tls-tls13-orig.txt&nbsp;</th><th> </th><th>&nbsp;draft-ietf-tls-tls13.txt&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> page 2, line 28</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> page 2, line 28</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   than English.</td><td> </td><td class="right">   than English.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Table of Contents</td><td> </td><td class="right">Table of Contents</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   4</td><td> </td><td class="right">   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   4</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     1.1.  Requirements Terminology  . . . . . . . . . . . . . . . .   5</td><td> </td><td class="right">     1.1.  Requirements Terminology  . . . . . . . . . . . . . . . .   5</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     1.2.  Major Differences from TLS 1.2  . . . . . . . . . . . . .   5</td><td> </td><td class="right">     1.2.  Major Differences from TLS 1.2  . . . . . . . . . . . . .   5</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   2.  Goals . . . . . . . . . . . . . . . . . . . . . . . . . . . .   6</td><td> </td><td class="right">   2.  Goals . . . . . . . . . . . . . . . . . . . . . . . . . . . .   6</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   3.  Goals of This Document  . . . . . . . . . . . . . . . . . . .   7</td><td> </td><td class="right">   3.  Goals of This Document  . . . . . . . . . . . . . . . . . . .   7</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   4.  Presentation Language . . . . . . . . . . . . . . . . . . . .   7</td><td> </td><td class="right">   4.  Presentation Language . . . . . . . . . . . . . . . . . . . .   7</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     4.1.  Basic Block Size  . . . . . . . . . . . . . . . . . . . .   <span class="delete">7</span></td><td> </td><td class="rblock">     4.1.  Basic Block Size  . . . . . . . . . . . . . . . . . . . .   <span class="insert">8</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     4.2.  Miscellaneous . . . . . . . . . . . . . . . . . . . . . .   8</td><td> </td><td class="right">     4.2.  Miscellaneous . . . . . . . . . . . . . . . . . . . . . .   8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     4.3.  Vectors . . . . . . . . . . . . . . . . . . . . . . . . .   8</td><td> </td><td class="right">     4.3.  Vectors . . . . . . . . . . . . . . . . . . . . . . . . .   8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     4.4.  Numbers . . . . . . . . . . . . . . . . . . . . . . . . .   9</td><td> </td><td class="right">     4.4.  Numbers . . . . . . . . . . . . . . . . . . . . . . . . .   9</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     4.5.  Enumerateds . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete"> 9</span></td><td> </td><td class="rblock">     4.5.  Enumerateds . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">10</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     4.6.  Constructed Types . . . . . . . . . . . . . . . . . . . .  10</td><td> </td><td class="right">     4.6.  Constructed Types . . . . . . . . . . . . . . . . . . . .  10</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       4.6.1.  Variants  . . . . . . . . . . . . . . . . . . . . . .  11</td><td> </td><td class="right">       4.6.1.  Variants  . . . . . . . . . . . . . . . . . . . . . .  11</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     4.7.  Cryptographic Attributes  . . . . . . . . . . . . . . . .  12</td><td> </td><td class="right">     4.7.  Cryptographic Attributes  . . . . . . . . . . . . . . . .  12</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     4.8.  Constants . . . . . . . . . . . . . . . . . . . . . . . .  14</td><td> </td><td class="right">     4.8.  Constants . . . . . . . . . . . . . . . . . . . . . . . .  14</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   5.  <span class="delete">The Pseudorandom Function</span> . . . . . . . . . . . . . . . . . .  15</td><td> </td><td class="rblock">   5.  <span class="insert">HKDF  . . . . . . . . . .</span> . . . . . . . . . . . . . . . . . .  15</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   6.  The TLS Record Protocol . . . . . . . . . . . . . . . . . . .  16</td><td> </td><td class="right">   6.  The TLS Record Protocol . . . . . . . . . . . . . . . . . . .  16</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.1.  Connection States . . . . . . . . . . . . . . . . . . . .  16</td><td> </td><td class="right">     6.1.  Connection States . . . . . . . . . . . . . . . . . . . .  16</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.2.  Record Layer  . . . . . . . . . . . . . . . . . . . . . .  19</td><td> </td><td class="right">     6.2.  Record Layer  . . . . . . . . . . . . . . . . . . . . . .  19</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       6.2.1.  Fragmentation . . . . . . . . . . . . . . . . . . . .  19</td><td> </td><td class="right">       6.2.1.  Fragmentation . . . . . . . . . . . . . . . . . . . .  19</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       6.2.2.  Record Payload Protection . . . . . . . . . . . . . .  20</td><td> </td><td class="right">       6.2.2.  Record Payload Protection . . . . . . . . . . . . . .  20</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.3.  Key Calculation . . . . . . . . . . . . . . . . . . . . .  22</td><td> </td><td class="right">     6.3.  Key Calculation . . . . . . . . . . . . . . . . . . . . .  22</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   7.  The TLS Handshaking Protocols . . . . . . . . . . . . . . . .  23</td><td> </td><td class="right">   7.  The TLS Handshaking Protocols . . . . . . . . . . . . . . . .  23</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     7.1.  Alert Protocol  . . . . . . . . . . . . . . . . . . . . .  <span class="delete">24</span></td><td> </td><td class="rblock">     7.1.  Alert Protocol  . . . . . . . . . . . . . . . . . . . . .  <span class="insert">23</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.1.1.  Closure Alerts  . . . . . . . . . . . . . . . . . . .  <span class="delete">25</span></td><td> </td><td class="rblock">       7.1.1.  Closure Alerts  . . . . . . . . . . . . . . . . . . .  <span class="insert">24</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       7.1.2.  Error Alerts  . . . . . . . . . . . . . . . . . . . .  25</td><td> </td><td class="right">       7.1.2.  Error Alerts  . . . . . . . . . . . . . . . . . . . .  25</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     7.2.  Handshake Protocol Overview . . . . . . . . . . . . . . .  <span class="delete">29</span></td><td> </td><td class="rblock">     7.2.  Handshake Protocol Overview . . . . . . . . . . . . . . .  <span class="insert">28</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     7.3.  Handshake Protocol  . . . . . . . . . . . . . . . . . . .  <span class="delete">33</span></td><td> </td><td class="rblock">     7.3.  Handshake Protocol  . . . . . . . . . . . . . . . . . . .  <span class="insert">32</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.1.  Hello Messages  . . . . . . . . . . . . . . . . . . .  <span class="delete">34</span></td><td> </td><td class="rblock">       7.3.1.  Hello Messages  . . . . . . . . . . . . . . . . . . .  <span class="insert">33</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.2.  Client Key Share Message  . . . . . . . . . . . . . .  <span class="delete">37</span></td><td> </td><td class="rblock">       7.3.2.  Client Key Share Message  . . . . . . . . . . . . . .  <span class="insert">36</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.3.  Server Key Share Message  . . . . . . . . . . . . . .  <span class="delete">48</span></td><td> </td><td class="rblock">       7.3.3.  Server Key Share Message  . . . . . . . . . . . . . .  <span class="insert">47</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.4.  Encrypted Extensions  . . . . . . . . . . . . . . . .  <span class="delete">49</span></td><td> </td><td class="rblock">       7.3.4.  Encrypted Extensions  . . . . . . . . . . . . . . . .  <span class="insert">48</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.5.  Server Certificate  . . . . . . . . . . . . . . . . .  <span class="delete">49</span></td><td> </td><td class="rblock">       7.3.5.  Server Certificate  . . . . . . . . . . . . . . . . .  <span class="insert">48</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.6.  Certificate Request . . . . . . . . . . . . . . . . .  <span class="delete">52</span></td><td> </td><td class="rblock">       7.3.6.  Certificate Request . . . . . . . . . . . . . . . . .  <span class="insert">51</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.7.  Server <span class="delete">Certificate Verify</span> . . . . . . . . . . . . . .  <span class="delete">53</span></td><td> </td><td class="rblock">       7.3.7.  Server <span class="insert">Parameters . .</span> . . . . . . . . . . . . . . <span class="insert">. .  52</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.8.  Server Finished . . . . . . . . . . . . . . . . . . .  <span class="delete">55</span></td><td> </td><td class="rblock">       7.3.8.  Server Finished . . . . . . . . . . . . . . . . . . .  <span class="insert">54</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       7.3.9.  Client Certificate  . . . . . . . . . . . . . . . . .  56</td><td> </td><td class="right">       7.3.9.  Client Certificate  . . . . . . . . . . . . . . . . .  56</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       7.3.10. Client Certificate Verify . . . . . . . . . . . . . .  5<span class="delete">8</span></td><td> </td><td class="rblock">       7.3.10. Client Certificate Verify . . . . . . . . . . . . . .  5<span class="insert">7</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   8.  Cryptographic Computations  . . . . . . . . . . . . . . . . .  58</td><td> </td><td class="right">   8.  Cryptographic Computations  . . . . . . . . . . . . . . . . .  58</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     8.1.  Computing the Master <span class="delete">Secret .</span> . . . . . . . . . . . . . .  59</td><td> </td><td class="rblock">     8.1.  Computing the Master <span class="insert">Secrets</span>  . . . . . . . . . . . . . .  59</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       8.1.1.  The Session Hash  . . . . . . . . . . . . . . . . . .  <span class="delete">60</span></td><td> </td><td class="rblock">       8.1.1.  The Session Hash  . . . . . . . . . . . . . . . . . .  <span class="insert">62</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       8.1.2.  Diffie-Hellman  . . . . . . . . . . . . . . . . . . .  <span class="delete">61</span></td><td> </td><td class="rblock">       8.1.2.  Diffie-Hellman  . . . . . . . . . . . . . . . . . . .  <span class="insert">62</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       8.1.3.  Elliptic Curve Diffie-Hellman . . . . . . . . . . . .  <span class="delete">61</span></td><td> </td><td class="rblock">       8.1.3.  Elliptic Curve Diffie-Hellman . . . . . . . . . . . .  <span class="insert">63</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   9.  Mandatory Cipher Suites . . . . . . . . . . . . . . . . . . .  <span class="delete">61</span></td><td> </td><td class="rblock">   9.  Mandatory Cipher Suites . . . . . . . . . . . . . . . . . . .  <span class="insert">63</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   10. Application Data Protocol . . . . . . . . . . . . . . . . . .  <span class="delete">61</span></td><td> </td><td class="rblock">   10. Application Data Protocol . . . . . . . . . . . . . . . . . .  <span class="insert">63</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   11. Security Considerations . . . . . . . . . . . . . . . . . . .  <span class="delete">62</span></td><td> </td><td class="rblock">   11. Security Considerations . . . . . . . . . . . . . . . . . . .  <span class="insert">63</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   12. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <span class="delete">62</span></td><td> </td><td class="rblock">   12. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <span class="insert">63</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   13. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">63</span></td><td> </td><td class="rblock">   13. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">65</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     13.1.  Normative References . . . . . . . . . . . . . . . . . .  <span class="delete">63</span></td><td> </td><td class="rblock">     13.1.  Normative References . . . . . . . . . . . . . . . . . .  <span class="insert">65</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     13.2.  Informative References . . . . . . . . . . . . . . . . .  <span class="delete">65</span></td><td> </td><td class="rblock">     13.2.  Informative References . . . . . . . . . . . . . . . . .  <span class="insert">66</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     13.3.  URIs . . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">68</span></td><td> </td><td class="rblock">     13.3.  URIs . . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">69</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix A.  Protocol Data Structures and Constant Values . . . .  <span class="delete">69</span></td><td> </td><td class="rblock">   Appendix A.  Protocol Data Structures and Constant Values . . . .  <span class="insert">70</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.1.  Record Layer  . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">69</span></td><td> </td><td class="rblock">     A.1.  Record Layer  . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">70</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.2.  Alert Messages  . . . . . . . . . . . . . . . . . . . . .  <span class="delete">69</span></td><td> </td><td class="rblock">     A.2.  Alert Messages  . . . . . . . . . . . . . . . . . . . . .  <span class="insert">70</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.3.  Handshake Protocol  . . . . . . . . . . . . . . . . . . .  <span class="delete">70</span></td><td> </td><td class="rblock">     A.3.  Handshake Protocol  . . . . . . . . . . . . . . . . . . .  <span class="insert">71</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.1.  Hello Messages  . . . . . . . . . . . . . . . . . . .  <span class="delete">71</span></td><td> </td><td class="rblock">       A.3.1.  Hello Messages  . . . . . . . . . . . . . . . . . . .  <span class="insert">72</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.2.  Key Exchange Messages . . . . . . . . . . . . . . . .  <span class="delete">74</span></td><td> </td><td class="rblock">       A.3.2.  Key Exchange Messages . . . . . . . . . . . . . . . .  <span class="insert">75</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.3.  Authentication Messages . . . . . . . . . . . . . . .  <span class="delete">74</span></td><td> </td><td class="rblock">       A.3.3.  Authentication Messages . . . . . . . . . . . . . . .  <span class="insert">75</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.4.  Handshake Finalization Messages . . . . . . . . . . .  <span class="delete">75</span></td><td> </td><td class="rblock">       A.3.4.  Handshake Finalization Messages . . . . . . . . . . .  <span class="insert">76</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.4.  The Cipher Suite  . . . . . . . . . . . . . . . . . . . .  <span class="delete">75</span></td><td> </td><td class="rblock">     A.4.  The Cipher Suite  . . . . . . . . . . . . . . . . . . . .  <span class="insert">76</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.5.  The Security Parameters . . . . . . . . . . . . . . . . .  <span class="delete">77</span></td><td> </td><td class="rblock">     A.5.  The Security Parameters . . . . . . . . . . . . . . . . .  <span class="insert">78</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.6.  Changes to RFC 4492 . . . . . . . . . . . . . . . . . . .  <span class="delete">77</span></td><td> </td><td class="rblock">     A.6.  Changes to RFC 4492 . . . . . . . . . . . . . . . . . . .  <span class="insert">78</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix B.  Glossary . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">78</span></td><td> </td><td class="rblock">   Appendix B.  Glossary . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">79</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix C.  Cipher Suite Definitions . . . . . . . . . . . . . .  <span class="delete">81</span></td><td> </td><td class="rblock">   Appendix C.  Cipher Suite Definitions . . . . . . . . . . . . . .  <span class="insert">82</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix D.  Implementation Notes . . . . . . . . . . . . . . . .  <span class="delete">81</span></td><td> </td><td class="rblock">   Appendix D.  Implementation Notes . . . . . . . . . . . . . . . .  <span class="insert">82</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     D.1.  Random Number Generation and Seeding  . . . . . . . . . .  <span class="delete">81</span></td><td> </td><td class="rblock">     D.1.  Random Number Generation and Seeding  . . . . . . . . . .  <span class="insert">82</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     D.2.  Certificates and Authentication . . . . . . . . . . . . .  82</td><td> </td><td class="right">     D.2.  Certificates and Authentication . . . . . . . . . . . . .  82</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     D.3.  Cipher Suites . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">82</span></td><td> </td><td class="rblock">     D.3.  Cipher Suites . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">83</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     D.4.  Implementation Pitfalls . . . . . . . . . . . . . . . . .  <span class="delete">82</span></td><td> </td><td class="rblock">     D.4.  Implementation Pitfalls . . . . . . . . . . . . . . . . .  <span class="insert">83</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix E.  Backward Compatibility . . . . . . . . . . . . . . .  <span class="delete">83</span></td><td> </td><td class="rblock">   Appendix E.  Backward Compatibility . . . . . . . . . . . . . . .  <span class="insert">84</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     E.1.  Compatibility with prior versions . . . . . . . . . . . .  <span class="delete">83</span></td><td> </td><td class="rblock">     E.1.  Compatibility with prior versions . . . . . . . . . . . .  <span class="insert">84</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     E.2.  Compatibility with SSL  . . . . . . . . . . . . . . . . .  85</td><td> </td><td class="right">     E.2.  Compatibility with SSL  . . . . . . . . . . . . . . . . .  85</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix F.  Security Analysis  . . . . . . . . . . . . . . . . .  <span class="delete">85</span></td><td> </td><td class="rblock">   Appendix F.  Security Analysis  . . . . . . . . . . . . . . . . .  <span class="insert">86</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     F.1.  Handshake Protocol  . . . . . . . . . . . . . . . . . . .  <span class="delete">85</span></td><td> </td><td class="rblock">     F.1.  Handshake Protocol  . . . . . . . . . . . . . . . . . . .  <span class="insert">86</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       F.1.1.  Authentication and Key Exchange . . . . . . . . . . .  86</td><td> </td><td class="right">       F.1.1.  Authentication and Key Exchange . . . . . . . . . . .  86</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       F.1.2.  Version Rollback Attacks  . . . . . . . . . . . . . .  <span class="delete">87</span></td><td> </td><td class="rblock">       F.1.2.  Version Rollback Attacks  . . . . . . . . . . . . . .  <span class="insert">88</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       F.1.3.  Detecting Attacks Against the Handshake Protocol  . .  <span class="delete">87</span></td><td> </td><td class="rblock">       F.1.3.  Detecting Attacks Against the Handshake Protocol  . .  <span class="insert">88</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       F.1.4.  Resuming Sessions . . . . . . . . . . . . . . . . . .  <span class="delete">87</span></td><td> </td><td class="rblock">       F.1.4.  Resuming Sessions . . . . . . . . . . . . . . . . . .  <span class="insert">88</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     F.2.  Protecting Application Data . . . . . . . . . . . . . . .  <span class="delete">88</span></td><td> </td><td class="rblock">     F.2.  Protecting Application Data . . . . . . . . . . . . . . .  <span class="insert">89</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     F.3.  Denial of Service . . . . . . . . . . . . . . . . . . . .  <span class="delete">88</span></td><td> </td><td class="rblock">     F.3.  Denial of Service . . . . . . . . . . . . . . . . . . . .  <span class="insert">89</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     F.4.  Final Notes . . . . . . . . . . . . . . . . . . . . . . .  89</td><td> </td><td class="right">     F.4.  Final Notes . . . . . . . . . . . . . . . . . . . . . . .  89</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix G.  Working Group Information  . . . . . . . . . . . . .  <span class="delete">89</span></td><td> </td><td class="rblock">   Appendix G.  Working Group Information  . . . . . . . . . . . . .  <span class="insert">90</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix H.  Contributors . . . . . . . . . . . . . . . . . . . .  <span class="delete">89</span></td><td> </td><td class="rblock">   Appendix H.  Contributors . . . . . . . . . . . . . . . . . . . .  <span class="insert">90</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">1.  Introduction</td><td> </td><td class="right">1.  Introduction</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   DISCLAIMER: This is a WIP draft of TLS 1.3 and has not yet seen</td><td> </td><td class="right">   DISCLAIMER: This is a WIP draft of TLS 1.3 and has not yet seen</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   significant security analysis.</td><td> </td><td class="right">   significant security analysis.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   RFC EDITOR: PLEASE REMOVE THE FOLLOWING PARAGRAPH The source for this</td><td> </td><td class="right">   RFC EDITOR: PLEASE REMOVE THE FOLLOWING PARAGRAPH The source for this</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   draft is maintained in GitHub.  Suggested changes should be submitted</td><td> </td><td class="right">   draft is maintained in GitHub.  Suggested changes should be submitted</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   as pull requests at https://github.com/tlswg/tls13-spec.</td><td> </td><td class="right">   as pull requests at https://github.com/tlswg/tls13-spec.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Instructions are on that page as well.  Editorial changes can be</td><td> </td><td class="right">   Instructions are on that page as well.  Editorial changes can be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> page 5, line 36</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> page 5, line 36</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">1.1.  Requirements Terminology</td><td> </td><td class="right">1.1.  Requirements Terminology</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",</td><td> </td><td class="right">   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and</td><td> </td><td class="right">   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   "OPTIONAL" in this document are to be interpreted as described in RFC</td><td> </td><td class="right">   "OPTIONAL" in this document are to be interpreted as described in RFC</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   2119 [RFC2119].</td><td> </td><td class="right">   2119 [RFC2119].</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">1.2.  Major Differences from TLS 1.2</td><td> </td><td class="right">1.2.  Major Differences from TLS 1.2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">draft-06</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   -  Start integration of semi-ephemeral DH proposal (OPTLS)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   draft-05</td><td> </td><td class="right">   draft-05</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Prohibit SSL negotiation for backwards compatibility.</td><td> </td><td class="right">   -  Prohibit SSL negotiation for backwards compatibility.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Fix which MS is used for exporters.</td><td> </td><td class="right">   -  Fix which MS is used for exporters.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   draft-04</td><td> </td><td class="right">   draft-04</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Modify key computations to include session hash.</td><td> </td><td class="right">   -  Modify key computations to include session hash.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> page 15, line 12</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> page 15, line 12</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   For example:</td><td> </td><td class="right">   For example:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8 f1;</td><td> </td><td class="right">          uint8 f1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8 f2;</td><td> </td><td class="right">          uint8 f2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } Example1;</td><td> </td><td class="right">      } Example1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Example1 ex1 = {1, 4};  /* assigns f1 = 1, f2 = 4 */</td><td> </td><td class="right">      Example1 ex1 = {1, 4};  /* assigns f1 = 1, f2 = 4 */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">5.  <span class="delete">The Pseudorandom Function</span></td><td> </td><td class="rblock">5.  <span class="insert">HKDF</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">A construction is required to do expansion of secrets into blocks of</span></td><td> </td><td class="rblock">   <span class="insert">TLS uses HKDF [RFC5869]</span> for key <span class="insert">expansion.  HKDF provides two</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   data</span> for <span class="delete">the purposes of</span> key <span class="delete">generation or validation.  This</span></td><td> </td><td class="rblock"><span class="insert">   functions.  HKDF-Extract is used to generate</span> a <span class="insert">pseudorandom key (PRK)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   pseudorandom function (PRF) takes as input a secret,</span> a <span class="delete">seed, and an</span></td><td> </td><td class="rblock"><span class="insert">   from</span> an <span class="insert">input keying material (IKM) value:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   identifying label and produces</span> an <span class="delete">output of arbitrary length.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">In this section, we define one PRF, based on HMAC [RFC2104].  This</span></td><td> </td><td class="rblock">      <span class="insert">HKDF-Extract(salt, IKM)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   PRF with the SHA-256 hash function is used for all cipher suites</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   defined in this document and in TLS documents published prior to this</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   document when TLS 1.2 is negotiated.  New cipher suites MUST</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   explicitly specify a PRF and, in general, SHOULD use the TLS PRF with</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   SHA-256 or a stronger standard hash function.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">First, we define</span> a <span class="delete">data expansion function, P_hash(secret, data),</span></td><td> </td><td class="rblock">   <span class="insert">salt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   that uses a single hash function to expand a secret and seed into an</span></td><td> </td><td class="rblock">      a <span class="insert">salt value</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   arbitrary quantity of output:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">P_hash(secret, seed) = HMAC_hash(secret, A(1) + seed) +</span></td><td> </td><td class="rblock">   <span class="insert">IKM</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                             HMAC_hash(secret, A(2) + seed) +</span></td><td> </td><td class="rblock"><span class="insert">      input keying material (e.g., a pre-shared key or a (EC)DH shared</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                             HMAC_hash(secret, A(3) + seed) + ...</span></td><td> </td><td class="rblock"><span class="insert">      secret.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">where + indicates concatenation.</span></td><td> </td><td class="rblock">   <span class="insert">The HKDF-Expand function is used to generate keys from a pseudo-</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   random key:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">A() is defined as:</span></td><td> </td><td class="rblock">   <span class="insert">    HKDF-Expand(PRK, info, length)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">A(0) = seed</span></td><td> </td><td class="rblock">   <span class="insert">PRK</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      A(i) = HMAC_hash(secret, A(i-1))</span></td><td> </td><td class="rblock"><span class="insert">      the pseudo-random key used as a source of entropy.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">P_hash can be iterated as many times as necessary to produce the</span></td><td> </td><td class="rblock">   <span class="insert">info</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   required quantity of data.  For example, if P_SHA256 is being used to</span></td><td> </td><td class="rblock"><span class="insert">      application context information.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   create 80 bytes of data, it will have to be iterated three times</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   (through A(3)), creating 96 bytes of output data; the last 16 bytes</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   of the final iteration will then be discarded, leaving 80 bytes of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   output data.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">TLS's PRF is created by applying P_hash to</span> the <span class="delete">secret as:</span></td><td> </td><td class="rblock">   <span class="insert">length</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">      the <span class="insert">desired output length in octets.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">PRF(secret, label, seed) = P_&lt;hash&gt;(secret, label + seed)</span></td><td> </td><td class="rblock">   <span class="insert">In TLS, HKDF</span> is <span class="insert">often invoked with</span> an <span class="insert">info parameter constructed</span> by</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   The label</span> is an <span class="delete">ASCII string.  It should be included in the exact</span></td><td> </td><td class="rblock">   <span class="insert">concatenating a fixed "label" and a variable "seed", as in</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   form it is given without a length byte or trailing null character.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   For example, the label "slithy toves" would be processed</span> by <span class="delete">hashing</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   the following bytes:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">73 6C 69 74 68 79 20 74 6F 76 65 73</span></td><td> </td><td class="rblock">      <span class="insert">"label" + seed</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The label is represented as an ASCII string, including the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   terminating NUL value and the seed is directly concatenated after the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   NUL.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">6.  The TLS Record Protocol</td><td> </td><td class="right">6.  The TLS Record Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The TLS Record Protocol is a layered protocol.  At each layer,</td><td> </td><td class="right">   The TLS Record Protocol is a layered protocol.  At each layer,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   messages may include fields for length, description, and content.</td><td> </td><td class="right">   messages may include fields for length, description, and content.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The Record Protocol takes messages to be transmitted, fragments the</td><td> </td><td class="right">   The Record Protocol takes messages to be transmitted, fragments the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   data into manageable blocks, protects the records, and transmits the</td><td> </td><td class="right">   data into manageable blocks, protects the records, and transmits the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   result.  Received data is decrypted and verified, reassembled, and</td><td> </td><td class="right">   result.  Received data is decrypted and verified, reassembled, and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   then delivered to higher-level clients.</td><td> </td><td class="right">   then delivered to higher-level clients.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> page 16, line 47</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> page 16, line 41</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Note in particular that type and length of a record are not protected</td><td> </td><td class="right">   Note in particular that type and length of a record are not protected</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   by encryption.  If this information is itself sensitive, application</td><td> </td><td class="right">   by encryption.  If this information is itself sensitive, application</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   designers may wish to take steps (padding, cover traffic) to minimize</td><td> </td><td class="right">   designers may wish to take steps (padding, cover traffic) to minimize</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   information leakage.</td><td> </td><td class="right">   information leakage.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">6.1.  Connection States</td><td> </td><td class="right">6.1.  Connection States</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   A TLS connection state is the operating environment of the TLS Record</td><td> </td><td class="right">   A TLS connection state is the operating environment of the TLS Record</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Protocol.  It specifies a record protection algorithm and its</td><td> </td><td class="right">   Protocol.  It specifies a record protection algorithm and its</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   parameters as well as the record protection keys <span class="delete">and IVs</span> for the</td><td> </td><td class="rblock">   parameters as well as the record protection keys for the connection</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   connection in both the read and the write directions.  The security</td><td> </td><td class="rblock">   in both the read and the write directions.  The security parameters</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   parameters are set by the TLS Handshake Protocol, which also</td><td> </td><td class="rblock">   are set by the TLS Handshake Protocol, which also determines when new</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   determines when new cryptographic keys are installed and used for</td><td> </td><td class="rblock">   cryptographic keys are installed and used for record protection.  The</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   record protection.  The initial current state always specifies that</td><td> </td><td class="rblock">   initial current state always specifies that records are not</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   records are not protected.</td><td> </td><td class="rblock">   protected.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The security parameters for a TLS Connection read and write state are</td><td> </td><td class="right">   The security parameters for a TLS Connection read and write state are</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   set by providing the following values:</td><td> </td><td class="right">   set by providing the following values:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   connection end</td><td> </td><td class="right">   connection end</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Whether this entity is considered the "client" or the "server" in</td><td> </td><td class="right">      Whether this entity is considered the "client" or the "server" in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      this connection.</td><td> </td><td class="right">      this connection.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">PRF</span> algorithm</td><td> </td><td class="rblock">   <span class="insert">KDF</span> algorithm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">An</span> algorithm used to generate keys <span class="delete">from the master secret (see</span></td><td> </td><td class="rblock">      <span class="insert">The hash</span> algorithm used <span class="insert">with HKDF [RFC5869]</span> to generate keys</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      Section 5 and</span> Section 6.3).</td><td> </td><td class="rblock">      Section 6.3).  <span class="insert">kdf_length denotes the output length of this hash.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   record protection algorithm</td><td> </td><td class="right">   record protection algorithm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The algorithm to be used for record protection.  This algorithm</td><td> </td><td class="right">      The algorithm to be used for record protection.  This algorithm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      must be of the AEAD type and thus provides integrity and</td><td> </td><td class="right">      must be of the AEAD type and thus provides integrity and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      confidentiality as a single primitive.  It is possible to have</td><td> </td><td class="right">      confidentiality as a single primitive.  It is possible to have</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      AEAD algorithms which do not provide any confidentiality and</td><td> </td><td class="right">      AEAD algorithms which do not provide any confidentiality and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Section 6.2.2 defines a special NULL_NULL AEAD algorithm for use</td><td> </td><td class="right">      Section 6.2.2 defines a special NULL_NULL AEAD algorithm for use</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      in the initial handshake).  This specification includes the key</td><td> </td><td class="right">      in the initial handshake).  This specification includes the key</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      size of this algorithm and <span class="delete">the lengths</span> of <span class="delete">explicit and implicit</span></td><td> </td><td class="rblock">      size of this algorithm and of the <span class="insert">nonce</span> for the <span class="insert">AEAD algorithm.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      initialization vectors (or nonces).</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   handshake master secret</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      A 48-byte secret shared between the two peers in</span> the <span class="delete">connection</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      and used to generate keys</span> for <span class="delete">protecting</span> the <span class="delete">handshake.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   master secret</td><td> </td><td class="right">   master secret</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      A 48-byte secret shared between the two peers in the connection</td><td> </td><td class="right">      A 48-byte secret shared between the two peers in the connection</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      and used to generate keys for protecting <span class="delete">application</span> data.</td><td> </td><td class="rblock">      and used to generate keys for protecting data.  <span class="insert">The TLS handshake</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      generates multiple master secrets in different handshake phases.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   client random</td><td> </td><td class="right">   client random</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      A 32-byte value provided by the client.</td><td> </td><td class="right">      A 32-byte value provided by the client.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   server random</td><td> </td><td class="right">   server random</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      A 32-byte value provided by the server.</td><td> </td><td class="right">      A 32-byte value provided by the server.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   These parameters are defined in the presentation language as:</td><td> </td><td class="right">   These parameters are defined in the presentation language as:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { server, client } ConnectionEnd;</td><td> </td><td class="right">      enum { server, client } ConnectionEnd;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      enum { <span class="delete">tls_prf_sha256 } PR</span>FAlgorithm;</td><td> </td><td class="rblock">      enum { <span class="insert">sha256, sha384 } KD</span>FAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { aes_gcm } RecordProtAlgorithm;</td><td> </td><td class="right">      enum { aes_gcm } RecordProtAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* The algorithms specified in <span class="delete">PR</span>FAlgorithm and</td><td> </td><td class="rblock">      /* The algorithms specified in <span class="insert">KD</span>FAlgorithm and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         RecordProtAlgorithm may be added to. */</td><td> </td><td class="right">         RecordProtAlgorithm may be added to. */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ConnectionEnd          entity;</td><td> </td><td class="right">          ConnectionEnd          entity;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          <span class="delete">PRFAlgorithm           prf_algorithm;</span></td><td> </td><td class="rblock">          <span class="insert">KDFAlgorithm           kdf_algorithm;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">          uint8                  kdf_length;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          RecordProtAlgorithm    record_prot_algorithm;</td><td> </td><td class="right">          RecordProtAlgorithm    record_prot_algorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8                  enc_key_length;</td><td> </td><td class="right">          uint8                  enc_key_length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8                  block_length;</td><td> </td><td class="right">          uint8                  block_length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          <span class="delete">uint8                  fixed_iv_length;</span></td><td> </td><td class="rblock">          opaque                 <span class="insert">auth_master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">          uint8                  record_iv_length;</span></td><td> </td><td class="rblock">          opaque                 <span class="insert">hs_master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          opaque                 <span class="delete">hs_master_secret[48];</span></td><td> </td><td class="rblock"><span class="insert">          opaque                 master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          opaque                 <span class="delete">master_secret[48];</span></td><td> </td><td class="rblock"><span class="insert">          opaque                 exporter_master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          opaque                 client_random[32];</td><td> </td><td class="right">          opaque                 client_random[32];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          opaque                 server_random[32];</td><td> </td><td class="right">          opaque                 server_random[32];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } SecurityParameters;</td><td> </td><td class="right">      } SecurityParameters;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The record layer will use the security parameters to generate the</td><td> </td><td class="right">   The record layer will use the security parameters to generate the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   following four items (some of which are not required by all ciphers,</td><td> </td><td class="right">   following four items (some of which are not required by all ciphers,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   and are thus empty):</td><td> </td><td class="right">   and are thus empty):</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      client write key</td><td> </td><td class="right">      client write key</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      server write key</td><td> </td><td class="right">      server write key</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">client write IV</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      server write IV</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The client write parameters are used by the server when receiving and</td><td> </td><td class="right">   The client write parameters are used by the server when receiving and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   processing records and vice versa.  The algorithm used for generating</td><td> </td><td class="right">   processing records and vice versa.  The algorithm used for generating</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   these items from the security parameters is described in Section 6.3</td><td> </td><td class="right">   these items from the security parameters is described in Section 6.3</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Once the security parameters have been set and the keys have been</td><td> </td><td class="right">   Once the security parameters have been set and the keys have been</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   generated, the connection states can be instantiated by making them</td><td> </td><td class="right">   generated, the connection states can be instantiated by making them</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the current states.  These current states MUST be updated for each</td><td> </td><td class="right">   the current states.  These current states MUST be updated for each</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   record processed.  Each connection state includes the following</td><td> </td><td class="right">   record processed.  Each connection state includes the following</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   elements:</td><td> </td><td class="right">   elements:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> page 19, line 37</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> page 19, line 35</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8 major;</td><td> </td><td class="right">          uint8 major;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8 minor;</td><td> </td><td class="right">          uint8 minor;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } ProtocolVersion;</td><td> </td><td class="right">      } ProtocolVersion;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ProtocolVersion version = { 3, 4 };     /* TLS v1.3*/</td><td> </td><td class="right">      ProtocolVersion version = { 3, 4 };     /* TLS v1.3*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum {</td><td> </td><td class="right">      enum {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          reserved(20), alert(21), handshake(22),</td><td> </td><td class="right">          reserved(20), alert(21), handshake(22),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          application_data(23), (255)</td><td> </td><td class="rblock">          application_data(23),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">          (255)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } ContentType;</td><td> </td><td class="right">      } ContentType;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ContentType type;</td><td> </td><td class="right">          ContentType type;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ProtocolVersion version;</td><td> </td><td class="right">          ProtocolVersion version;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint16 length;</td><td> </td><td class="right">          uint16 length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          opaque fragment[TLSPlaintext.length];</td><td> </td><td class="right">          opaque fragment[TLSPlaintext.length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } TLSPlaintext;</td><td> </td><td class="right">      } TLSPlaintext;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   type</td><td> </td><td class="right">   type</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> page 20, line 45</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> page 20, line 43</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   AEAD ciphers take as input a single key, a nonce, a plaintext, and</td><td> </td><td class="right">   AEAD ciphers take as input a single key, a nonce, a plaintext, and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   "additional data" to be included in the authentication check, as</td><td> </td><td class="right">   "additional data" to be included in the authentication check, as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   described in Section 2.1 of [RFC5116].  The key is either the</td><td> </td><td class="right">   described in Section 2.1 of [RFC5116].  The key is either the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   client_write_key or the server_write_key.</td><td> </td><td class="right">   client_write_key or the server_write_key.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ContentType type;</td><td> </td><td class="right">          ContentType type;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ProtocolVersion version;</td><td> </td><td class="right">          ProtocolVersion version;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint16 length;</td><td> </td><td class="right">          uint16 length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">          opaque nonce_explicit[SecurityParameters.record_iv_length];</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          aead-ciphered struct {</td><td> </td><td class="right">          aead-ciphered struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">             opaque content[TLSPlaintext.length];</td><td> </td><td class="right">             opaque content[TLSPlaintext.length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          } fragment;</td><td> </td><td class="right">          } fragment;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } TLSCiphertext;</td><td> </td><td class="right">      } TLSCiphertext;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   type</td><td> </td><td class="right">   type</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The type field is identical to TLSPlaintext.type.</td><td> </td><td class="right">      The type field is identical to TLSPlaintext.type.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   version</td><td> </td><td class="right">   version</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The version field is identical to TLSPlaintext.version.</td><td> </td><td class="right">      The version field is identical to TLSPlaintext.version.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   length</td><td> </td><td class="right">   length</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The length (in bytes) of the following TLSCiphertext.fragment.</td><td> </td><td class="right">      The length (in bytes) of the following TLSCiphertext.fragment.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The length MUST NOT exceed 2^14 + 2048.</td><td> </td><td class="right">      The length MUST NOT exceed 2^14 + 2048.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   fragment</td><td> </td><td class="right">   fragment</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The AEAD encrypted form of TLSPlaintext.fragment.</td><td> </td><td class="right">      The AEAD encrypted form of TLSPlaintext.fragment.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Each AEAD cipher suite MUST specify how the</span> nonce <span class="delete">supplied to</span> the</td><td> </td><td class="rblock">   <span class="insert">The</span> nonce <span class="insert">for</span> the AEAD <span class="insert">construction</span> is <span class="insert">formed by taking the 64-bit</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   AEAD <span class="delete">operation</span> is <span class="delete">constructed,</span> and <span class="delete">what is the length of the</span></td><td> </td><td class="rblock"><span class="insert">   sequence number</span> and <span class="insert">padding</span> it <span class="insert">on</span> the <span class="insert">left</span> with <span class="insert">zeroes to N_MIN if</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   TLSCiphertext.nonce_explicit part.  In many cases,</span> it <span class="delete">is appropriate</span></td><td> </td><td class="rblock"><span class="insert">   N_MIN is greater than 64 bits (see [RFC5116] Section 4).  An AEAD</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   to use</span> the <span class="delete">partially implicit nonce technique described in</span></td><td> </td><td class="rblock"><span class="insert">   algorithm where N_MAX is less than 64 bits MUST not</span> be <span class="insert">used with TLS.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   Section 3.2.1 of [RFC5116];</span> with <span class="delete">record_iv_length being the length of</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   the explicit part.  In this case, the implicit part SHOULD</span> be <span class="delete">derived</span></td><td> </td><td class="rblock"><span class="insert">   Note: This is a different construction</span> from <span class="insert">that</span> in <span class="insert">TLS 1.2, which</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   from <span class="delete">key_block as client_write_iv and server_write_iv (as described</span></td><td> </td><td class="rblock"><span class="insert">   specified a partially</span> explicit <span class="insert">nonce.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   in <span class="delete">Section 6.3), and the</span> explicit <span class="delete">part is included in</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   GenericAEAEDCipher.nonce_explicit.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The plaintext is the TLSPlaintext.fragment.</td><td> </td><td class="right">   The plaintext is the TLSPlaintext.fragment.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The additional authenticated data, which we denote as</td><td> </td><td class="right">   The additional authenticated data, which we denote as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   additional_data, is defined as follows:</td><td> </td><td class="right">   additional_data, is defined as follows:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      additional_data = seq_num + TLSPlaintext.type +</td><td> </td><td class="right">      additional_data = seq_num + TLSPlaintext.type +</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                        TLSPlaintext.version</td><td> </td><td class="right">                        TLSPlaintext.version</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   where "+" denotes concatenation.</td><td> </td><td class="right">   where "+" denotes concatenation.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> page 22, line 35</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> page 22, line 32</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [[OPEN ISSUE: This needs to be revised.  See</td><td> </td><td class="right">   [[OPEN ISSUE: This needs to be revised.  See</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   https://github.com/tlswg/tls13-spec/issues/5]] The Record Protocol</td><td> </td><td class="right">   https://github.com/tlswg/tls13-spec/issues/5]] The Record Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   requires an algorithm to generate keys required by the current</td><td> </td><td class="right">   requires an algorithm to generate keys required by the current</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   connection state (see Appendix A.5) from the security parameters</td><td> </td><td class="right">   connection state (see Appendix A.5) from the security parameters</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   provided by the handshake protocol.</td><td> </td><td class="right">   provided by the handshake protocol.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The master secret is expanded into a sequence of secure bytes, which</td><td> </td><td class="right">   The master secret is expanded into a sequence of secure bytes, which</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   is then split to a client write encryption key and a server write</td><td> </td><td class="right">   is then split to a client write encryption key and a server write</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   encryption key.  Each of these is generated from the byte sequence in</td><td> </td><td class="right">   encryption key.  Each of these is generated from the byte sequence in</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   that order.  Unused values are empty.  <span class="delete">Some ciphers may additionally</span></td><td> </td><td class="rblock">   that order.  Unused values are empty.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   require a client write IV and a server write IV.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When keys are generated, the current master secret (MS) is used as an</td><td> </td><td class="right">   When keys are generated, the current master secret (MS) is used as an</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   entropy source.  For handshake records, this means the</td><td> </td><td class="rblock">   entropy source.  For handshake records, this means the <span class="insert">handshake</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">hs_master_secret.</span>  For application data records, this means the</td><td> </td><td class="rblock"><span class="insert">   master secret.</span>  For application data records, this means the regular</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   regular <span class="delete">master_secret.</span></td><td> </td><td class="rblock">   <span class="insert">master secret.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   To generate the key<span class="delete"> material, compute</span></td><td> </td><td class="rblock">   To generate the key<span class="insert">s, compute:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">key_block</span> = <span class="delete">PRF(MS,</span></td><td> </td><td class="rblock">  <span class="insert">client_write_key</span> = <span class="insert">HKDF-Expand(Secret, "client write key"</span> + <span class="insert">session_hash,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                      "key expansion",</span></td><td> </td><td class="rblock"><span class="insert">                                 SecurityParameters.enc_key_length)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                      SecurityParameters.server_random</span> +</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                      <span class="delete">SecurityParameters.client_random);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   where MS is the relevant master secret.  The PRF is computed enough</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   times to generate the necessary amount of data for the key_block,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   which is then partitioned as follows:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">client_write_key[SecurityParameters.enc_key_length]</span></td><td> </td><td class="rblock">  <span class="insert">server_write_key = HKDF-Expand(Secret, "server write key" + session_hash,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      server_write_key[SecurityParameters.enc_key_length]</span></td><td> </td><td class="rblock"><span class="insert">                                 SecurityParameters.enc_key_length)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      client_write_IV[SecurityParameters.fixed_iv_length]</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      server_write_IV[SecurityParameters.fixed_iv_length]</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Currently,</span> the <span class="delete">client_write_IV</span> and <span class="delete">server_write_IV are only generated</span></td><td> </td><td class="rblock">   <span class="insert">Where Secret is</span> the <span class="insert">relevant master secret</span> and <span class="insert">session_hash is the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   for implicit nonce techniques as described</span> in Section <span class="delete">3.2.1 of</span></td><td> </td><td class="rblock"><span class="insert">   value defined</span> in Section <span class="insert">8.1.1.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   [RFC5116].</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">7.  The TLS Handshaking Protocols</td><td> </td><td class="right">7.  The TLS Handshaking Protocols</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS has three subprotocols that are used to allow peers to agree upon</td><td> </td><td class="right">   TLS has three subprotocols that are used to allow peers to agree upon</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   security parameters for the record layer, to authenticate themselves,</td><td> </td><td class="right">   security parameters for the record layer, to authenticate themselves,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   to instantiate negotiated security parameters, and to report error</td><td> </td><td class="right">   to instantiate negotiated security parameters, and to report error</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   conditions to each other.</td><td> </td><td class="right">   conditions to each other.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The Handshake Protocol is responsible for negotiating a session,</td><td> </td><td class="right">   The Handshake Protocol is responsible for negotiating a session,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   which consists of the following items:</td><td> </td><td class="right">   which consists of the following items:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> page 23, line 37</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> page 23, line 25</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   session identifier</td><td> </td><td class="right">   session identifier</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      An arbitrary byte sequence chosen by the server to identify an</td><td> </td><td class="right">      An arbitrary byte sequence chosen by the server to identify an</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      active or resumable session state.</td><td> </td><td class="right">      active or resumable session state.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   peer certificate</td><td> </td><td class="right">   peer certificate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      X509v3 [RFC3280] certificate of the peer.  This element of the</td><td> </td><td class="right">      X509v3 [RFC3280] certificate of the peer.  This element of the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      state may be null.</td><td> </td><td class="right">      state may be null.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   cipher spec</td><td> </td><td class="right">   cipher spec</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Specifies the authentication and key establishment algorithms, the</td><td> </td><td class="right">      Specifies the authentication and key establishment algorithms, the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">pseudorandom</span> function <span class="delete">(PRF)</span> used to generate keying material, and</td><td> </td><td class="rblock">      <span class="insert">key derivation</span> function <span class="insert">(KDF)</span> used to generate keying material,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      the record protection algorithm (See Appendix A.5 for formal</td><td> </td><td class="rblock">      and the record protection algorithm (See Appendix A.5 for formal</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      definition.)</td><td> </td><td class="right">      definition.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   resumption <span class="delete">pre</span>master secret</td><td> </td><td class="rblock">   resumption master secret</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      48-byte secret shared between the client and server.</td><td> </td><td class="right">      48-byte secret shared between the client and server.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   is resumable</td><td> </td><td class="right">   is resumable</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      A flag indicating whether the session can be used to initiate new</td><td> </td><td class="right">      A flag indicating whether the session can be used to initiate new</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      connections.</td><td> </td><td class="right">      connections.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   These items are then used to create security parameters for use by</td><td> </td><td class="right">   These items are then used to create security parameters for use by</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the record layer when protecting application data.  Many connections</td><td> </td><td class="right">   the record layer when protecting application data.  Many connections</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   can be instantiated using the same session through the resumption</td><td> </td><td class="right">   can be instantiated using the same session through the resumption</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   feature of the TLS Handshake Protocol.</td><td> </td><td class="right">   feature of the TLS Handshake Protocol.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> page 29, line 26</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> page 29, line 14</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   optionally authenticate each other, and use public-key encryption</td><td> </td><td class="right">   optionally authenticate each other, and use public-key encryption</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   techniques to generate shared secrets.</td><td> </td><td class="right">   techniques to generate shared secrets.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The TLS Handshake Protocol involves the following steps:</td><td> </td><td class="right">   The TLS Handshake Protocol involves the following steps:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Exchange hello messages to agree on a protocol version,</td><td> </td><td class="right">   -  Exchange hello messages to agree on a protocol version,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      algorithms, exchange random values, and check for session</td><td> </td><td class="right">      algorithms, exchange random values, and check for session</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      resumption.</td><td> </td><td class="right">      resumption.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Exchange the necessary cryptographic parameters to allow the</td><td> </td><td class="right">   -  Exchange the necessary cryptographic parameters to allow the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      client and server to agree on <span class="delete">a premaster secret</span>.</td><td> </td><td class="rblock">      client and server to agree on <span class="insert">shared secret values</span>.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Exchange certificates and cryptographic information to allow the</td><td> </td><td class="right">   -  Exchange certificates and cryptographic information to allow the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      client and server to authenticate themselves.</td><td> </td><td class="right">      client and server to authenticate themselves.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   -  Generate a master <span class="delete">secret</span> from the <span class="delete">premaster secret</span> and exchanged</td><td> </td><td class="rblock">   -  Generate a <span class="insert">series of</span> master <span class="insert">secrets</span> from the <span class="insert">shared secrets</span> and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      random values.</td><td> </td><td class="rblock">      exchanged random values.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Provide security parameters to the record layer.</td><td> </td><td class="right">   -  Provide security parameters to the record layer.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Allow the client and server to verify that their peer has</td><td> </td><td class="right">   -  Allow the client and server to verify that their peer has</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      calculated the same security parameters and that the handshake</td><td> </td><td class="right">      calculated the same security parameters and that the handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      occurred without tampering by an attacker.</td><td> </td><td class="right">      occurred without tampering by an attacker.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Note that higher layers should not be overly reliant on whether TLS</td><td> </td><td class="right">   Note that higher layers should not be overly reliant on whether TLS</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   always negotiates the strongest possible connection between two</td><td> </td><td class="right">   always negotiates the strongest possible connection between two</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   peers.  There are a number of ways in which a man-in-the-middle</td><td> </td><td class="right">   peers.  There are a number of ways in which a man-in-the-middle</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l10" /><small>skipping to change at</small><em> page 30, line 25</em></th><th> </th><th><a name="part-r10" /><small>skipping to change at</small><em> page 30, line 14</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   If the client has provided a ClientKeyShare with an appropriate set</td><td> </td><td class="right">   If the client has provided a ClientKeyShare with an appropriate set</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   of keying material, the server responds to the ClientHello with a</td><td> </td><td class="right">   of keying material, the server responds to the ClientHello with a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ServerHello message.  The ServerHello contains the server's nonce</td><td> </td><td class="right">   ServerHello message.  The ServerHello contains the server's nonce</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   (ServerHello.random), the server's choice of the Protocol Version,</td><td> </td><td class="right">   (ServerHello.random), the server's choice of the Protocol Version,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Session ID and Cipher Suite, and the server's response to the</td><td> </td><td class="right">   Session ID and Cipher Suite, and the server's response to the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   extensions the client offered.</td><td> </td><td class="right">   extensions the client offered.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The server can then generate its own keying material share and send a</td><td> </td><td class="right">   The server can then generate its own keying material share and send a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ServerKeyShare message which contains its share of the parameters for</td><td> </td><td class="right">   ServerKeyShare message which contains its share of the parameters for</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the key agreement.  The server can now compute <span class="delete">the</span> shared secret (the</td><td> </td><td class="rblock">   the <span class="insert">ephemeral</span> key agreement.  The server can now compute <span class="insert">a</span> shared</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">premaster</span> secret).  At this point, the server starts encrypting all</td><td> </td><td class="rblock">   secret (the <span class="insert">ephemeral</span> secret).  At this point, the server starts</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   remaining handshake traffic with the negotiated cipher suite using a</td><td> </td><td class="rblock">   encrypting all remaining handshake traffic with the negotiated cipher</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   key derived from the <span class="delete">premaster secret (via the "handshake master</span></td><td> </td><td class="rblock">   suite using a key derived from the <span class="insert">ephemeral secret.</span>  The remainder</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   secret").</span>  The remainder of the server's handshake messages will be</td><td> </td><td class="rblock">   of the server's handshake messages will be encrypted using that key.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   encrypted using that key.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Following these messages, the server will send an EncryptedExtensions</td><td> </td><td class="right">   Following these messages, the server will send an EncryptedExtensions</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   message which contains a response to any <span class="delete">client's</span> extensions which</td><td> </td><td class="rblock">   message which contains a response to any <span class="insert">client</span> extensions which are</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   are not necessary to establish the Cipher Suite.  The server will</td><td> </td><td class="rblock">   not necessary to establish the Cipher Suite.  The server will then</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   then send its certificate in a Certificate message if it is to be</td><td> </td><td class="rblock">   send its certificate in a Certificate message if it is to be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   authenticated.  The server may optionally request a certificate from</td><td> </td><td class="right">   authenticated.  The server may optionally request a certificate from</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the client by sending a CertificateRequest message at this point.</td><td> </td><td class="rblock">   the client by sending a CertificateRequest message at this point.  <span class="insert">If</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Finally, if</span> the server is <span class="delete">authenticated,</span> it will send a</td><td> </td><td class="rblock">   the server is <span class="insert">authenticated by a certificate,</span> it will <span class="insert">then</span> send a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">CertificateVerify</span> message <span class="delete">which provides a signature over the entire</span></td><td> </td><td class="rblock">   <span class="insert">ServerParameters</span> message to <span class="insert">provide its semi-static key pair.</span>  This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   handshake up</span> to <span class="delete">this point.</span>  This <span class="delete">serves both to authenticate</span> the</td><td> </td><td class="rblock">   <span class="insert">semi-static key pair is combined with</span> the <span class="insert">client's ephemeral key to</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">server and</span> to <span class="delete">establish the integrity of</span> the <span class="delete">negotiation.</span>  Finally,</td><td> </td><td class="rblock"><span class="insert">   form a static secret which is transitively bound</span> to the <span class="insert">server's</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the server sends a Finished message which includes an integrity check</td><td> </td><td class="rblock"><span class="insert">   certificate.</span>  Finally, the server sends a Finished message which</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   over the handshake keyed by the <span class="delete">shared secret and</span> demonstrates that</td><td> </td><td class="rblock">   includes an integrity check over the handshake keyed by the <span class="insert">static</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the server and client have agreed upon the same <span class="delete">keys.</span>  [[TODO: If the</td><td> </td><td class="rblock"><span class="insert">   secret; the Finised message</span> demonstrates that the server and client</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   server is not requesting client authentication, it MAY start sending</td><td> </td><td class="rblock">   have agreed upon the same <span class="insert">keys and that the server's ephemeral key is</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   application data following the Finished, though the server has no way</td><td> </td><td class="rblock"><span class="insert">   bound to its authenticated semi-static key pair.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   of knowing who will be receiving the data.  Add this.]]</td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   [[TODO: If the server is not requesting client authentication, it MAY</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   start sending application data following the Finished, though the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   server has no way of knowing who will be receiving the data.  Add</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   this.]]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Once the client receives the ServerKeyShare, it can also compute the</td><td> </td><td class="right">   Once the client receives the ServerKeyShare, it can also compute the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">premaster</span> secret and decrypt the server's remaining handshake</td><td> </td><td class="rblock">   <span class="insert">ephemeral</span> secret and decrypt the server's remaining handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   messages.  The client generates its own sending keys based on the</td><td> </td><td class="right">   messages.  The client generates its own sending keys based on the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">premaster</span> secret and will encrypt the remainder of its handshake</td><td> </td><td class="rblock">   <span class="insert">ephemeral</span> secret and will encrypt the remainder of its handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   messages using those keys and the newly established cipher suite.  If</td><td> </td><td class="right">   messages using those keys and the newly established cipher suite.  If</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the server has sent a CertificateRequest message, the client MUST</td><td> </td><td class="right">   the server has sent a CertificateRequest message, the client MUST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   send the Certificate message, though it may contain zero</td><td> </td><td class="right">   send the Certificate message, though it may contain zero</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   certificates.  If the client has sent a certificate, a digitally-</td><td> </td><td class="right">   certificates.  If the client has sent a certificate, a digitally-</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   signed CertificateVerify message is sent to explicitly verify</td><td> </td><td class="right">   signed CertificateVerify message is sent to explicitly verify</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   possession of the private key in the certificate.  Finally, the</td><td> </td><td class="right">   possession of the private key in the certificate.  Finally, the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   client sends <span class="delete">the</span> Finished message.</td><td> </td><td class="rblock">   client sends <span class="insert">its own</span> Finished message.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   At this point, the handshake is complete, and the client and server</td><td> </td><td class="right">   At this point, the handshake is complete, and the client and server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   may exchange application layer data, which is protected using a new</td><td> </td><td class="right">   may exchange application layer data, which is protected using a new</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   set of keys derived from both the <span class="delete">premaster secret</span> and the handshake</td><td> </td><td class="rblock">   set of keys derived from both the <span class="insert">ephemeral and static secrets</span> and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   transcript (see [I-D.ietf-tls-session-hash] for the security</td><td> </td><td class="rblock">   the handshake transcript (see [I-D.ietf-tls-session-hash] for the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   rationale for this.)</td><td> </td><td class="rblock">   security rationale for this.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Application data MUST NOT be sent prior to the Finished message.</td><td> </td><td class="right">   Application data MUST NOT be sent prior to the Finished message.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [[TODO: can we make this clearer and more clearly match the text</td><td> </td><td class="right">   [[TODO: can we make this clearer and more clearly match the text</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   above about server-side False Start.]] Client Server</td><td> </td><td class="right">   above about server-side False Start.]] Client Server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ClientHello</td><td> </td><td class="right">      ClientHello</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ClientKeyShare            --------&gt;</td><td> </td><td class="right">      ClientKeyShare            --------&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                      ServerHello</td><td> </td><td class="right">                                                      ServerHello</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                   ServerKeyShare</td><td> </td><td class="right">                                                   ServerKeyShare</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                           {EncryptedExtensions*}</td><td> </td><td class="right">                                           {EncryptedExtensions*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                   {Certificate*}</td><td> </td><td class="right">                                                   {Certificate*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                            {CertificateRequest*}</td><td> </td><td class="right">                                            {CertificateRequest*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                             <span class="delete">{CertificateVerify</span>*}</td><td> </td><td class="rblock">                                             <span class="insert"> {ServerParameters</span>*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                &lt;--------              {Finished}</td><td> </td><td class="right">                                &lt;--------              {Finished}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      {Certificate*}</td><td> </td><td class="right">      {Certificate*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      {CertificateVerify*}</td><td> </td><td class="right">      {CertificateVerify*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      {Finished}                --------&gt;</td><td> </td><td class="right">      {Finished}                --------&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      [Application Data]        &lt;-------&gt;      [Application Data]</td><td> </td><td class="right">      [Application Data]        &lt;-------&gt;      [Application Data]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Figure 1.  Message flow for a full handshake</td><td> </td><td class="right">               Figure 1.  Message flow for a full handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   * Indicates optional or situation-dependent messages that are not</td><td> </td><td class="right">   * Indicates optional or situation-dependent messages that are not</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   always sent.</td><td> </td><td class="right">   always sent.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l11" /><small>skipping to change at</small><em> page 32, line 20</em></th><th> </th><th><a name="part-r11" /><small>skipping to change at</small><em> page 32, line 18</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ClientKeyShare            --------&gt;</td><td> </td><td class="right">      ClientKeyShare            --------&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                &lt;--------       HelloRetryRequest</td><td> </td><td class="right">                                &lt;--------       HelloRetryRequest</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ClientHello</td><td> </td><td class="right">      ClientHello</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ClientKeyShare            --------&gt;</td><td> </td><td class="right">      ClientKeyShare            --------&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                      ServerHello</td><td> </td><td class="right">                                                      ServerHello</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                   ServerKeyShare</td><td> </td><td class="right">                                                   ServerKeyShare</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                           {EncryptedExtensions*}</td><td> </td><td class="right">                                           {EncryptedExtensions*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                   {Certificate*}</td><td> </td><td class="right">                                                   {Certificate*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                            {CertificateRequest*}</td><td> </td><td class="right">                                            {CertificateRequest*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                             <span class="delete">{CertificateVerify</span>*}</td><td> </td><td class="rblock">                                             <span class="insert"> {ServerParameters</span>*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                &lt;--------              {Finished}</td><td> </td><td class="right">                                &lt;--------              {Finished}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      {Certificate*}</td><td> </td><td class="right">      {Certificate*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      {CertificateVerify*}</td><td> </td><td class="right">      {CertificateVerify*}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      {Finished}                --------&gt;</td><td> </td><td class="right">      {Finished}                --------&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      [Application Data]        &lt;-------&gt;     [Application Data]</td><td> </td><td class="right">      [Application Data]        &lt;-------&gt;     [Application Data]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Figure 2.  Message flow for a full handshake with mismatched</td><td> </td><td class="right">   Figure 2.  Message flow for a full handshake with mismatched</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   parameters</td><td> </td><td class="right">   parameters</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [[OPEN ISSUE: Should we restart the handshake hash?</td><td> </td><td class="right">   [[OPEN ISSUE: Should we restart the handshake hash?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l12" /><small>skipping to change at</small><em> page 32, line 42</em></th><th> </th><th><a name="part-r12" /><small>skipping to change at</small><em> page 32, line 40</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   need to make sure that this flow doesn't introduce downgrade issues.</td><td> </td><td class="right">   need to make sure that this flow doesn't introduce downgrade issues.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Potential options include continuing the handshake hashes (as long as</td><td> </td><td class="right">   Potential options include continuing the handshake hashes (as long as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   clients don't change their opinion of the server's capabilities with</td><td> </td><td class="right">   clients don't change their opinion of the server's capabilities with</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   aborted handshakes) and requiring the client to send the same</td><td> </td><td class="right">   aborted handshakes) and requiring the client to send the same</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ClientHello (as is currently done) and then checking you get the same</td><td> </td><td class="right">   ClientHello (as is currently done) and then checking you get the same</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   negotiated parameters.]]</td><td> </td><td class="right">   negotiated parameters.]]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   If no common cryptographic parameters can be negotiated, the server</td><td> </td><td class="right">   If no common cryptographic parameters can be negotiated, the server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   will send a fatal alert.</td><td> </td><td class="right">   will send a fatal alert.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">When the client and server decide to resume a previous session or</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   duplicate an existing session (instead of negotiating new security</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   parameters), the message flow is as follows:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   The client sends a ClientHello using the Session ID of the session to</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   be resumed.  The server then checks its session cache for a match.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   If a match is found, and the server is willing to re-establish the</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   connection under the specified session state, it will send a</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   ServerHello with the same Session ID value.  At this point, both</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   client and server MUST proceed directly to sending Finished messages,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   which are protected using handshake keys as described above, computed</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   using resumption premaster secret created in the first handshake as</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   the premaster secret.  Once the re-establishment is complete, the</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   client and server MAY begin to exchange application layer data, which</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   is protected using the application secrets (See flow chart below.)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   If a Session ID match is not found, the server generates a new</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   session ID, and the TLS client and server perform a full handshake.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      Client                                                Server</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      ClientHello</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      ClientKeyExhange              --------&gt;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                                       ServerHello</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                    &lt;--------           {Finished}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      {Finished}                    --------&gt;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      [Application Data]            &lt;-------&gt;   [Application Data]</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">          Figure 3.  Message flow for an abbreviated handshake</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The contents and significance of each message will be presented in</td><td> </td><td class="right">   The contents and significance of each message will be presented in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   detail in the following sections.</td><td> </td><td class="right">   detail in the following sections.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">7.3.  Handshake Protocol</td><td> </td><td class="right">7.3.  Handshake Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The TLS Handshake Protocol is one of the defined higher-level clients</td><td> </td><td class="right">   The TLS Handshake Protocol is one of the defined higher-level clients</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   of the TLS Record Protocol.  This protocol is used to negotiate the</td><td> </td><td class="right">   of the TLS Record Protocol.  This protocol is used to negotiate the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   secure attributes of a session.  Handshake messages are supplied to</td><td> </td><td class="right">   secure attributes of a session.  Handshake messages are supplied to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the TLS record layer, where they are encapsulated within one or more</td><td> </td><td class="right">   the TLS record layer, where they are encapsulated within one or more</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLSPlaintext structures, which are processed and transmitted as</td><td> </td><td class="right">   TLSPlaintext structures, which are processed and transmitted as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   specified by the current active session state.</td><td> </td><td class="right">   specified by the current active session state.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum {</td><td> </td><td class="right">      enum {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          reserved(0), client_hello(1), server_hello(2),</td><td> </td><td class="right">          reserved(0), client_hello(1), server_hello(2),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          client_key_share(5), hello_retry_request(6),</td><td> </td><td class="right">          client_key_share(5), hello_retry_request(6),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          server_key_share(7), certificate(11), reserved(12),</td><td> </td><td class="right">          server_key_share(7), certificate(11), reserved(12),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          certificate_request(13), certificate_verify(15),</td><td> </td><td class="rblock">          certificate_request(13), <span class="insert">server_parameters(14),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          reserved(16), finished(20), (255)</td><td> </td><td class="rblock">          certificate_verify(15), reserved(16), finished(20), (255)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } HandshakeType;</td><td> </td><td class="right">      } HandshakeType;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          HandshakeType msg_type;    /* handshake type */</td><td> </td><td class="right">          HandshakeType msg_type;    /* handshake type */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint24 length;             /* bytes in message */</td><td> </td><td class="right">          uint24 length;             /* bytes in message */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          select (HandshakeType) {</td><td> </td><td class="right">          select (HandshakeType) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case client_hello:        ClientHello;</td><td> </td><td class="right">              case client_hello:        ClientHello;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case client_key_share:    ClientKeyShare;</td><td> </td><td class="right">              case client_key_share:    ClientKeyShare;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case server_hello:        ServerHello;</td><td> </td><td class="right">              case server_hello:        ServerHello;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case hello_retry_request: HelloRetryRequest;</td><td> </td><td class="right">              case hello_retry_request: HelloRetryRequest;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case server_key_share:    ServerKeyShare;</td><td> </td><td class="right">              case server_key_share:    ServerKeyShare;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case certificate:         Certificate;</td><td> </td><td class="right">              case certificate:         Certificate;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case certificate_request: CertificateRequest;</td><td> </td><td class="right">              case certificate_request: CertificateRequest;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              case server_parameters:   ServerParameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case certificate_verify:  CertificateVerify;</td><td> </td><td class="right">              case certificate_verify:  CertificateVerify;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case finished:            Finished;</td><td> </td><td class="right">              case finished:            Finished;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          } body;</td><td> </td><td class="right">          } body;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } Handshake;</td><td> </td><td class="right">      } Handshake;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The handshake protocol messages are presented below in the order they</td><td> </td><td class="right">   The handshake protocol messages are presented below in the order they</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   MUST be sent; sending handshake messages in an unexpected order</td><td> </td><td class="right">   MUST be sent; sending handshake messages in an unexpected order</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   results in a fatal error.  Unneeded handshake messages can be</td><td> </td><td class="right">   results in a fatal error.  Unneeded handshake messages can be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   omitted, however.</td><td> </td><td class="right">   omitted, however.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l13" /><small>skipping to change at</small><em> page 36, line 6</em></th><th> </th><th><a name="part-r13" /><small>skipping to change at</small><em> page 35, line 7</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   session identifiers cause any breach of security.  (Note that the</td><td> </td><td class="right">   session identifiers cause any breach of security.  (Note that the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   content of the handshake as a whole, including the SessionID, is</td><td> </td><td class="right">   content of the handshake as a whole, including the SessionID, is</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   protected by the Finished messages exchanged at the end of the</td><td> </td><td class="right">   protected by the Finished messages exchanged at the end of the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   handshake.)</td><td> </td><td class="right">   handshake.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The cipher suite list, passed from the client to the server in the</td><td> </td><td class="right">   The cipher suite list, passed from the client to the server in the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ClientHello message, contains the combinations of cryptographic</td><td> </td><td class="right">   ClientHello message, contains the combinations of cryptographic</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   algorithms supported by the client in order of the client's</td><td> </td><td class="right">   algorithms supported by the client in order of the client's</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   preference (favorite choice first).  Each cipher suite defines a key</td><td> </td><td class="right">   preference (favorite choice first).  Each cipher suite defines a key</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   exchange algorithm, a record protection algorithm (including secret</td><td> </td><td class="right">   exchange algorithm, a record protection algorithm (including secret</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   key length) and a <span class="delete">PR</span>F.  The server will select a cipher suite or, if</td><td> </td><td class="rblock">   key length) and a <span class="insert">KD</span>F.  The server will select a cipher suite or, if</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   no acceptable choices are presented, return a handshake failure alert</td><td> </td><td class="right">   no acceptable choices are presented, return a handshake failure alert</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   and close the connection.  If the list contains cipher suites the</td><td> </td><td class="right">   and close the connection.  If the list contains cipher suites the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   server does not recognize, support, or wish to use, the server MUST</td><td> </td><td class="right">   server does not recognize, support, or wish to use, the server MUST</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ignore those cipher suites, and process the remaining ones as usual.</td><td> </td><td class="right">   ignore those cipher suites, and process the remaining ones as usual.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      uint8 CipherSuite[2];    /* Cryptographic suite selector */</td><td> </td><td class="right">      uint8 CipherSuite[2];    /* Cryptographic suite selector */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { null(0), (255) } CompressionMethod;</td><td> </td><td class="right">      enum { null(0), (255) } CompressionMethod;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l14" /><small>skipping to change at</small><em> page 47, line 32</em></th><th> </th><th><a name="part-r14" /><small>skipping to change at</small><em> page 46, line 32</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   NOTE: A server participating in an ECDHE-ECDSA key exchange may use</td><td> </td><td class="right">   NOTE: A server participating in an ECDHE-ECDSA key exchange may use</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   different curves for (i) the ECDSA key in its certificate, and (ii)</td><td> </td><td class="right">   different curves for (i) the ECDSA key in its certificate, and (ii)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the ephemeral ECDH key in the ServerKeyExchange message.  The server</td><td> </td><td class="right">   the ephemeral ECDH key in the ServerKeyExchange message.  The server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   must consider the supported groups in both cases.</td><td> </td><td class="right">   must consider the supported groups in both cases.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [[TODO: IANA Considerations.]]</td><td> </td><td class="right">   [[TODO: IANA Considerations.]]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">7.3.2.5.3.  Early Data Extension</td><td> </td><td class="right">7.3.2.5.3.  Early Data Extension</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0060" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">[TODO(ekr@rtfm.com): I think we should just push this into a</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ClientHello extension directly and then decree that any 0-RTT data</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   needs to be in separate messages.]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS versions before 1.3 have a strict message ordering and do not</td><td> </td><td class="right">   TLS versions before 1.3 have a strict message ordering and do not</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   permit additional messages to follow the ClientHello.  The EarlyData</td><td> </td><td class="right">   permit additional messages to follow the ClientHello.  The EarlyData</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   extension allows TLS messages which would otherwise be sent as</td><td> </td><td class="right">   extension allows TLS messages which would otherwise be sent as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   separate records to be instead inserted in the ClientHello.  The</td><td> </td><td class="right">   separate records to be instead inserted in the ClientHello.  The</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   extension simply contains the TLS records which would otherwise have</td><td> </td><td class="right">   extension simply contains the TLS records which would otherwise have</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   been included in the client's first flight.</td><td> </td><td class="right">   been included in the client's first flight.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         struct {</td><td> </td><td class="right">         struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">           TLSCipherText messages&lt;5 .. 2^24-1&gt;;</td><td> </td><td class="right">           TLSCipherText messages&lt;5 .. 2^24-1&gt;;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         } EarlyDataExtension;</td><td> </td><td class="right">         } EarlyDataExtension;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l15" /><small>skipping to change at</small><em> page 48, line 36</em></th><th> </th><th><a name="part-r15" /><small>skipping to change at</small><em> page 47, line 41</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When this message will be sent:</td><td> </td><td class="right">   When this message will be sent:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      This message will be sent immediately after the ServerHello</td><td> </td><td class="right">      This message will be sent immediately after the ServerHello</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      message if the client has provided a ClientKeyShare message which</td><td> </td><td class="right">      message if the client has provided a ClientKeyShare message which</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      is compatible with the selected cipher suite and group parameters.</td><td> </td><td class="right">      is compatible with the selected cipher suite and group parameters.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Meaning of this message:</td><td> </td><td class="right">   Meaning of this message:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      This message conveys cryptographic information to allow the client</td><td> </td><td class="right">      This message conveys cryptographic information to allow the client</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0061" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      to compute <span class="delete">the premaster</span> secret: a Diffie-Hellman public key with</td><td> </td><td class="rblock">      to compute <span class="insert">a shared</span> secret: a Diffie-Hellman public key with which</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      which the client can complete a key exchange (with the result</td><td> </td><td class="rblock">      the client can complete a key exchange (with the result being the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      being the <span class="delete">premaster</span> secret) or a public key for some other</td><td> </td><td class="rblock">      <span class="insert">shared</span> secret) or a public key for some other algorithm.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      algorithm.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Structure of this message:</td><td> </td><td class="right">   Structure of this message:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        NamedGroup group;</td><td> </td><td class="right">        NamedGroup group;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        opaque key_exchange&lt;1..2^16-1&gt;;</td><td> </td><td class="right">        opaque key_exchange&lt;1..2^16-1&gt;;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } ServerKeyShare;</td><td> </td><td class="right">      } ServerKeyShare;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0062" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                                                         </span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   group</td><td> </td><td class="right">   group</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The named group for the key share offer.  This identifies the</td><td> </td><td class="right">      The named group for the key share offer.  This identifies the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      selected key exchange method from the ClientKeyShare message</td><td> </td><td class="right">      selected key exchange method from the ClientKeyShare message</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      (Section 7.3.2), identifying which value from the</td><td> </td><td class="right">      (Section 7.3.2), identifying which value from the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ClientKeyShareOffer the server has accepted as is responding to.</td><td> </td><td class="right">      ClientKeyShareOffer the server has accepted as is responding to.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   key_exchange</td><td> </td><td class="right">   key_exchange</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Key exchange information.  The contents of this field are</td><td> </td><td class="right">      Key exchange information.  The contents of this field are</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      determined by the value of NamedGroup entry and its corresponding</td><td> </td><td class="right">      determined by the value of NamedGroup entry and its corresponding</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      definition.</td><td> </td><td class="right">      definition.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l16" /><small>skipping to change at</small><em> page 53, line 41</em></th><th> </th><th><a name="part-r16" /><small>skipping to change at</small><em> page 52, line 41</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   New ClientCertificateType values are assigned by IANA as described in</td><td> </td><td class="right">   New ClientCertificateType values are assigned by IANA as described in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Section 12.</td><td> </td><td class="right">   Section 12.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Note: Values listed as RESERVED may not be used.  They were used in</td><td> </td><td class="right">   Note: Values listed as RESERVED may not be used.  They were used in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   SSLv3.</td><td> </td><td class="right">   SSLv3.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Note: It is a fatal handshake_failure alert for an anonymous server</td><td> </td><td class="right">   Note: It is a fatal handshake_failure alert for an anonymous server</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   to request client authentication.</td><td> </td><td class="right">   to request client authentication.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0063" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">7.3.7.  Server <span class="delete">Certificate Verify</span></td><td> </td><td class="rblock">7.3.7.  Server <span class="insert">Parameters</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Meaning of this message:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      This message is used to convey the server's non-ephemeral DH/ECDHE</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      parameters, thus binding them to the long-term key in the server's</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      certificate.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When this message will be sent:</td><td> </td><td class="right">   When this message will be sent:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0064" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      This message <span class="delete">is used to provide explicit proof that the server</span></td><td> </td><td class="rblock">      This message MUST <span class="insert">immediately follow</span> the <span class="insert">Certificate</span> message</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      possesses the private key corresponding to its certificate.</span></td><td> </td><td class="rblock">      <span class="insert">whenever</span> the <span class="insert">server sends that message.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      certificate and also provides integrity for the handshake up to</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      this point.  This message is only sent when the server is</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      authenticated via a certificate.  When sent, it</span> MUST <span class="delete">be</span> the <span class="delete">last</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      server handshake</span> message <span class="delete">prior to</span> the <span class="delete">Finished.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0065" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Structure of this <span class="delete">message:</span></td><td> </td><td class="rblock">   Structure of this <span class="insert">Message:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      struct {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        uint64 not_before;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        uint64 not_after;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        opaque key_identifier&lt;0..2^8-1&gt;;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        NamedGroup group;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        opaque server_key&lt;1..2^16-1&gt;;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      } UnsignedParameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   not_before</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      The earliest time that the parameters are valid, expressed in</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      seconds since the UNIX epoch.  If this value is 0, then the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      parameters are only valid for this connection.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   not_after</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      The last time that the parameters are valid, expressed in seconds</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      since the UNIX epoch.  If this value is 0, then the parameters are</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      only valid for this connection.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   key_identifier</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      The key identifier to be used with the known configuration</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      extension [TODO] in known key mode.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   group</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      The same meaning as in ServerKeyShare.  This MUST be the same</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      group as used for that message.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   server_key</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      The server's DH key share.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      enum { online(0), (255)} ParametersType;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0066" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">          <span class="insert">UnsignedParameters parameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">          ParametersType params_type;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">           digitally-signed struct {</td><td> </td><td class="right">           digitally-signed struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0067" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               opaque <span class="delete">handshake_messages_hash[hash_length];</span></td><td> </td><td class="rblock">            <span class="insert">UnsignedParameters parameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           }</span></td><td> </td><td class="rblock">            opaque <span class="insert">session_hash[Hash.length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      } <span class="delete">CertificateVerify;</span></td><td> </td><td class="rblock"><span class="insert">          };</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">          opaque zero_rt_id&lt;0..2^16-1&gt;;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">      } <span class="insert">ServerParameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0068" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">Here handshake_messages_hash is a digest of all handshake messages</span></td><td> </td><td class="rblock">   <span class="insert">params_type</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      sent or received, starting at ClientHello and up to, but not</span></td><td> </td><td class="rblock"><span class="insert">      The</span> type of <span class="insert">parameters.  Currently this</span> MUST be <span class="insert">"online".</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      including, this message, including the</span> type <span class="delete">and length fields of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      the handshake messages.  This is a digest of the concatenation</span> of</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">all the Handshake structures (as defined in Section 7.3) exchanged</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      thus far.  For the PRF defined in Section 5, the digest</span> MUST be</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">the Hash used as the basis for the PRF.  Any cipher suite which</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      defines a different PRF MUST also define the Hash to use in this</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      computation.  Note that this is the same running hash that is used</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      in the Finished message Section 7.3.8.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0069" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      The <span class="delete">context string</span> for the <span class="delete">signature is "TLS 1.3, server</span></td><td> </td><td class="rblock">   <span class="insert">zero_rt_id</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      CertificateVerify".  A hash of the handshake messages is signed</span></td><td> </td><td class="rblock">      The <span class="insert">identifier</span> for the <span class="insert">0-RT</span> context <span class="insert">(if any) being established</span> by</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      rather than the messages themselves because the digitally-signed</span></td><td> </td><td class="rblock">      <span class="insert">this handshake.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      format requires padding and</span> context <span class="delete">bytes at the beginning of the</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      input.  Thus,</span> by <span class="delete">signing a digest of the messages, an</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      implementation need only maintain one running hash per hash type</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      for CertificateVerify, Finished and other messages.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0070" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">If the client has offered the "signature_algorithms" extension,</span></td><td> </td><td class="rblock">   <span class="insert">The ServerParameters structure</span> MUST be <span class="insert">signed by the terminal (end-</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      the signature algorithm and hash algorithm</span> MUST be <span class="delete">a pair listed</span></td><td> </td><td class="rblock"><span class="insert">   entity) certificate</span> in <span class="insert">the server's Certificate message.  The</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      in <span class="delete">that extension.  Note that there</span> is <span class="delete">a possibility for</span></td><td> </td><td class="rblock"><span class="insert">   signature value</span> is <span class="insert">computed as</span> the <span class="insert">concatenation of</span> the <span class="insert">serialized</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      inconsistencies here.  For instance,</span> the <span class="delete">client might offer</span></td><td> </td><td class="rblock"><span class="insert">   UnsignedParameters type and</span> the <span class="insert">session hash.  The context string for</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      DHE_DSS key exchange but omit any DSA pairs from its</span></td><td> </td><td class="rblock"><span class="insert">   this signature</span> is <span class="insert">"TLS 1.3, server parameters".</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      "signature_algorithms" extension.  In order to negotiate</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      correctly,</span> the <span class="delete">server MUST check any candidate cipher suites</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      against</span> the <span class="delete">"signature_algorithms" extension before selecting</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      them.  This is somewhat inelegant but</span> is <span class="delete">a compromise designed to</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      minimize changes to the original cipher suite design.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0071" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">In addition,</span> the <span class="delete">hash and</span> signature <span class="delete">algorithms MUST be compatible</span></td><td> </td><td class="rblock">   <span class="insert">The client MUST verify</span> the signature <span class="insert">prior to accepting it and</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      with the <span class="delete">key in</span> the <span class="delete">server's end-entity certificate.  RSA keys MAY</span></td><td> </td><td class="rblock"><span class="insert">   terminate the handshake</span> with <span class="insert">a fatal decrypt_error alert if</span> the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      be used with any permitted hash algorithm, subject to restrictions</span></td><td> </td><td class="rblock">   <span class="insert">signature fails.  If</span> the <span class="insert">client's idea of</span> the <span class="insert">current time is not</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      in</span> the <span class="delete">certificate, if any.</span></td><td> </td><td class="rblock"><span class="insert">   between the not_before and not_after values (inclusive) and those</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   values are non-zero, then the client MUST terminate the handshake</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   with a fatal certificate_expired alert.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0072" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">Because DSA signatures do not contain any secure indication of</span></td><td> </td><td class="rblock">   <span class="insert">If the not_before and not_after values</span> are <span class="insert">nonzero, then</span> the <span class="insert">client</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      hash algorithm, there is a risk of hash substitution if multiple</span></td><td> </td><td class="rblock"><span class="insert">   MAY cache the ServerParameters value for future</span> use <span class="insert">during the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      hashes may be used with any key.  Currently, DSA [DSS] may only be</span></td><td> </td><td class="rblock"><span class="insert">   lifespan indicated by those values.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      used with SHA-1.  Future revisions of DSS [DSS-3]</span> are <span class="delete">expected to</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      allow</span> the use <span class="delete">of other digest algorithms with DSA, as well as</span></td><td> </td><td class="rblock"><span class="insert">   It is explicitly permitted for the (EC)DH key in this message</span> to be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      guidance as</span> to <span class="delete">which digest algorithms should</span> be <span class="delete">used with each</span></td><td> </td><td class="rblock">   <span class="insert">the same as the</span> key <span class="insert">used in the server's ServerKeyShare message.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      key <span class="delete">size.  In addition, future revisions of [RFC3280] may specify</span></td><td> </td><td class="rblock"><span class="insert">   This server-side behavior allows the server</span> to <span class="insert">only do one (EC)DH</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      mechanisms for certificates</span> to <span class="delete">indicate</span> which <span class="delete">digest algorithms</span></td><td> </td><td class="rblock"><span class="insert">   variable base operation,</span> which <span class="insert">is a significant performance</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      are</span> to be <span class="delete">used with DSA.  [[TODO: Update</span> this to <span class="delete">deal with DSS-3</span></td><td> </td><td class="rblock"><span class="insert">   improvement.  In this case, the server MUST use a fresh DH ephemeral</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      and <span class="delete">DSS-4.  https://github.com/tlswg/tls13-spec/issues/59]]</span></td><td> </td><td class="rblock"><span class="insert">   value for each connection (otherwise PFS is lost) and MUST set the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   not_before and not_after values</span> to <span class="insert">0 so that the key will not</span> be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">cached.  that</span> this <span class="insert">implies that if the server wishes to enable 0-RT</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   mode, it cannot use this optimization.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   If the client wishes</span> to <span class="insert">optimize for this case, it MAY compare the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   two key share values</span> and <span class="insert">cache the (EC)DH computation if they are</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   equal.  Alternately, clients may simply perform the (EC)DH</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   computations independently.  In either case, the derived secrets will</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   be the same.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">7.3.8.  Server Finished</td><td> </td><td class="right">7.3.8.  Server Finished</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When this message will be sent:</td><td> </td><td class="right">   When this message will be sent:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The Server's Finished message is the final message sent by the</td><td> </td><td class="right">      The Server's Finished message is the final message sent by the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      server and indicates that the key exchange and authentication</td><td> </td><td class="right">      server and indicates that the key exchange and authentication</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      processes were successful.</td><td> </td><td class="right">      processes were successful.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Meaning of this message:</td><td> </td><td class="right">   Meaning of this message:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Recipients of Finished messages MUST verify that the contents are</td><td> </td><td class="right">      Recipients of Finished messages MUST verify that the contents are</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      correct.  Once a side has sent its Finished message and received</td><td> </td><td class="right">      correct.  Once a side has sent its Finished message and received</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      and validated the Finished message from its peer, it may begin to</td><td> </td><td class="right">      and validated the Finished message from its peer, it may begin to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      send and receive application data over the connection.  This data</td><td> </td><td class="right">      send and receive application data over the connection.  This data</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0073" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      will be protected under keys derived from the <span class="delete">hs_master_secret</span></td><td> </td><td class="rblock">      will be protected under keys derived from the <span class="insert">handshake master</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      (see Section <span class="delete">8.</span></td><td> </td><td class="rblock"><span class="insert">      secret</span> (see Section <span class="insert">8).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Structure of this message:</td><td> </td><td class="right">   Structure of this message:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0074" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          opaque verify_data[<span class="delete">verify_data</span>_length];</td><td> </td><td class="rblock">          opaque verify_data[<span class="insert">SecurityParameters.kdf</span>_length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } Finished;</td><td> </td><td class="right">      } Finished;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0075" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   verify_data</td><td> </td><td class="rblock">   <span class="insert">The</span> verify_data <span class="insert">value is computed as follows:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">PRF(hs_master_secret, finished_label, Hash(handshake_messages))</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      [0..verify_data_length-1];</span></td><td> </td><td class="rblock"><span class="insert">      verify_data = HKDF-Expand(finished_secret,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                finished_label + session_hash,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                SecurityParameters.kdf_length)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   finished_label</td><td> </td><td class="right">   finished_label</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      For Finished messages sent by the client, the string "client</td><td> </td><td class="right">      For Finished messages sent by the client, the string "client</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      finished".  For Finished messages sent by the server, the string</td><td> </td><td class="right">      finished".  For Finished messages sent by the server, the string</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      "server finished".</td><td> </td><td class="right">      "server finished".</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0076" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">Hash denotes a Hash of the handshake messages.  For the PRF</span></td><td> </td><td class="rblock">   <span class="insert">The finished_secret is computed as:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      defined in Section 5, the Hash MUST be the Hash used as the basis</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      for the PRF.  Any cipher suite which defines a different PRF MUST</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      also define the Hash to use in the Finished computation.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      In previous versions of TLS, the verify_data was always 12 octets</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      long.  In the current version of TLS, it depends on the cipher</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      suite.  Any cipher suite which does not explicitly specify</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      verify_data_length has a verify_data_length equal to 12.  This</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      includes all existing cipher suites.  Note that this</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      representation has the same encoding as with previous versions.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0077" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">Future cipher suites MAY specify other lengths but such length</span></td><td> </td><td class="rblock">        <span class="insert">finished_secret = HKDF-Expand(AMS,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      MUST be at least 12 bytes.</span></td><td> </td><td class="rblock"><span class="insert">                                      SecurityParameters.server_random +</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                      SecurityParameters.client_random,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                      SecurityParameters.kdf_length);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0078" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">handshake_messages</span></td><td> </td><td class="rblock">      <span class="insert">Hash denotes a Hash</span> of the handshake <span class="insert">messages.  When HKDF</span> is <span class="insert">used</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      All</span> of the <span class="delete">data from all messages in this</span> handshake <span class="delete">(not including</span></td><td> </td><td class="rblock"><span class="insert">      as</span> the <span class="insert">KDF, then</span> the <span class="insert">Hash MUST be</span> the <span class="insert">Hash used</span> as <span class="insert">the basis for</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      any HelloRequest messages) up to, but not including, this message.</span></td><td> </td><td class="rblock"><span class="insert">      the HKDF.  Any cipher suite which defines a different KDF MUST</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      This</span> is <span class="delete">only data visible at</span> the <span class="delete">handshake layer and does not</span></td><td> </td><td class="rblock"><span class="insert">      also define the Hash to use</span> in <span class="insert">the Finished computation.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      include record layer headers.  This is</span> the <span class="delete">concatenation of all</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      the <span class="delete">Handshake structures</span> as <span class="delete">defined</span> in <span class="delete">Section 7.3, exchanged thus</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      far.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The value handshake_messages includes all handshake messages starting</td><td> </td><td class="right">   The value handshake_messages includes all handshake messages starting</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   at ClientHello up to, but not including, this Finished message.  This</td><td> </td><td class="right">   at ClientHello up to, but not including, this Finished message.  This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   may be different from handshake_messages in Section 7.3.7 or</td><td> </td><td class="right">   may be different from handshake_messages in Section 7.3.7 or</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Section 7.3.10.  Also, the handshake_messages for the Finished</td><td> </td><td class="right">   Section 7.3.10.  Also, the handshake_messages for the Finished</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   message sent by the client will be different from that for the</td><td> </td><td class="right">   message sent by the client will be different from that for the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Finished message sent by the server, because the one that is sent</td><td> </td><td class="right">   Finished message sent by the server, because the one that is sent</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   second will include the prior one.</td><td> </td><td class="right">   second will include the prior one.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Note: Alerts and any other record types are not handshake messages</td><td> </td><td class="right">   Note: Alerts and any other record types are not handshake messages</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l17" /><small>skipping to change at</small><em> page 57, line 4</em></th><th> </th><th><a name="part-r17" /><small>skipping to change at</small><em> page 56, line 30</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      handshake (considering the client unauthenticated) or send a fatal</td><td> </td><td class="right">      handshake (considering the client unauthenticated) or send a fatal</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      alert.</td><td> </td><td class="right">      alert.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Client certificates are sent using the Certificate structure</td><td> </td><td class="right">      Client certificates are sent using the Certificate structure</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      defined in Section 7.3.5.</td><td> </td><td class="right">      defined in Section 7.3.5.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Meaning of this message:</td><td> </td><td class="right">   Meaning of this message:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      This message conveys the client's certificate chain to the server;</td><td> </td><td class="right">      This message conveys the client's certificate chain to the server;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      the server will use it when verifying the CertificateVerify</td><td> </td><td class="right">      the server will use it when verifying the CertificateVerify</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0079" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      message (when the client authentication is based on <span class="delete">signing) or</span></td><td> </td><td class="rblock">      message (when the client authentication is based on <span class="insert">signing).</span>  The</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      calculating the premaster secret (for non-ephemeral Diffie-</span></td><td> </td><td class="rblock">      certificate MUST be appropriate for the negotiated cipher suite's</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      Hellman).</span>  The certificate MUST be appropriate for the negotiated</td><td> </td><td class="rblock">      key exchange algorithm, and any negotiated extensions.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      cipher suite's key exchange algorithm, and any negotiated</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      extensions.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   In particular:</td><td> </td><td class="right">   In particular:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  The certificate type MUST be X.509v3, unless explicitly negotiated</td><td> </td><td class="right">   -  The certificate type MUST be X.509v3, unless explicitly negotiated</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      otherwise (e.g., [RFC5081]).</td><td> </td><td class="right">      otherwise (e.g., [RFC5081]).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  The end-entity certificate's public key (and associated</td><td> </td><td class="right">   -  The end-entity certificate's public key (and associated</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      restrictions) has to be compatible with the certificate types</td><td> </td><td class="right">      restrictions) has to be compatible with the certificate types</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      listed in CertificateRequest:</td><td> </td><td class="right">      listed in CertificateRequest:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l18" /><small>skipping to change at</small><em> page 58, line 23</em></th><th> </th><th><a name="part-r18" /><small>skipping to change at</small><em> page 58, line 4</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">7.3.10.  Client Certificate Verify</td><td> </td><td class="right">7.3.10.  Client Certificate Verify</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When this message will be sent:</td><td> </td><td class="right">   When this message will be sent:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      This message is used to provide explicit verification of a client</td><td> </td><td class="right">      This message is used to provide explicit verification of a client</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      certificate.  This message is only sent following a client</td><td> </td><td class="right">      certificate.  This message is only sent following a client</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      certificate that has signing capability (i.e., all certificates</td><td> </td><td class="right">      certificate that has signing capability (i.e., all certificates</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      except those containing fixed Diffie-Hellman parameters).  When</td><td> </td><td class="right">      except those containing fixed Diffie-Hellman parameters).  When</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      sent, it MUST immediately follow the client's Certificate message.</td><td> </td><td class="right">      sent, it MUST immediately follow the client's Certificate message.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0080" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">The contents</span> of the <span class="delete">message are computed as described</span> in</td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Section <span class="delete">7.3.7, except</span> that the context string is "TLS 1.3, client</td><td> </td><td class="rblock">   <span class="insert">Structure of this message:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      CertificateVerify".</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      struct {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           digitally-signed struct {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               opaque handshake_messages_hash[hash_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      } CertificateVerify;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      Here handshake_messages_hash is a digest</span> of <span class="insert">all handshake messages</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      sent or received, starting at ClientHello and up to, but not</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      including, this message, including</span> the <span class="insert">type and length fields of</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      the handshake messages.  This is a digest of the concatenation of</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      all the Handshake structures (as defined</span> in Section <span class="insert">7.3) exchanged</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      thus far.  The digest MUST be the Hash used as the basis for the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      KDF.  Note</span> that <span class="insert">this is</span> the <span class="insert">same running hash that is used in the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      Finished message Section 7.3.8.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      The</span> context string <span class="insert">for the signature</span> is "TLS 1.3, client</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">      CertificateVerify".  <span class="insert">A hash of the handshake messages is signed</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      rather than the messages themselves because the digitally-signed</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      format requires padding and context bytes at the beginning of the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      input.  Thus, by signing a digest of the messages, an</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      implementation need only maintain one running hash per hash type</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      for CertificateVerify, Finished and other messages.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The hash and signature algorithms used in the signature MUST be</td><td> </td><td class="right">      The hash and signature algorithms used in the signature MUST be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      one of those present in the supported_signature_algorithms field</td><td> </td><td class="right">      one of those present in the supported_signature_algorithms field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      of the CertificateRequest message.  In addition, the hash and</td><td> </td><td class="right">      of the CertificateRequest message.  In addition, the hash and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      signature algorithms MUST be compatible with the key in the</td><td> </td><td class="right">      signature algorithms MUST be compatible with the key in the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      client's end-entity certificate.  RSA keys MAY be used with any</td><td> </td><td class="right">      client's end-entity certificate.  RSA keys MAY be used with any</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      permitted hash algorithm, subject to restrictions in the</td><td> </td><td class="right">      permitted hash algorithm, subject to restrictions in the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      certificate, if any.</td><td> </td><td class="right">      certificate, if any.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Because DSA signatures do not contain any secure indication of</td><td> </td><td class="right">      Because DSA signatures do not contain any secure indication of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l19" /><small>skipping to change at</small><em> page 59, line 7</em></th><th> </th><th><a name="part-r19" /><small>skipping to change at</small><em> page 59, line 9</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">8.  Cryptographic Computations</td><td> </td><td class="right">8.  Cryptographic Computations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   In order to begin connection protection, the TLS Record Protocol</td><td> </td><td class="right">   In order to begin connection protection, the TLS Record Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   requires specification of a suite of algorithms, a master secret, and</td><td> </td><td class="right">   requires specification of a suite of algorithms, a master secret, and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the client and server random values.  The authentication, key</td><td> </td><td class="right">   the client and server random values.  The authentication, key</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   agreement, and record protection algorithms are determined by the</td><td> </td><td class="right">   agreement, and record protection algorithms are determined by the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   cipher_suite selected by the server and revealed in the ServerHello</td><td> </td><td class="right">   cipher_suite selected by the server and revealed in the ServerHello</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   message.  The random values are exchanged in the hello messages.  All</td><td> </td><td class="right">   message.  The random values are exchanged in the hello messages.  All</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   that remains is to calculate the master secret.</td><td> </td><td class="right">   that remains is to calculate the master secret.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0081" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">8.1.  Computing the Master Secret</td><td> </td><td class="rblock">8.1.  Computing the Master Secret<span class="insert">s</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0082" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   The <span class="delete">pre_master_secret</span> is used to <span class="delete">generate a series of master secret</span></td><td> </td><td class="rblock">   The <span class="insert">TLS handshake establishes secret keying material which</span> is <span class="insert">then</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   values,</span> as <span class="delete">shown</span> in the <span class="delete">following diagram and described below.</span></td><td> </td><td class="rblock">   used to <span class="insert">protect traffic.  Depending on the handshake parameters, this</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   keying material may be derived from either one or two shared secrets,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   as <span class="insert">described</span> in the <span class="insert">table below:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0083" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                <span class="delete">Premaster</span> Secret <span class="delete">&lt;---------+</span></td><td> </td><td class="rblock">     <span class="insert">Key Exchange            Static</span> Secret <span class="insert">(SS)    Ephemeral Secret (ES)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     ------------            ------------------    ---------------------</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     (EC)DHE                   Client ephemeral         Client ephemeral</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               w/ server static      w/ server ephemeral</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     PSK                         Pre-Shared Key                        0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     PSK + (EC)DHE               Pre-Shared Key         Client ephemeral</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                     w/ server ephemeral</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     Resumption                  Resumption PMS                        0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   These shared secret values are used to generate master secret values</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   as shown below.  For the handshake variants with only one secret, a</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   fixed string of 0s (indicated by 0 in the table above) is used</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   instead, allowing for a uniform derivation process for all handshake</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   modes.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The diagram below shows the derivation process modeled on HKDF</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   [RFC5869].  In this diagram, HKDF-Extract is shown taking the salt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   from the top and the IKM from the side, and HKDF-Expand generally</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   includes the session hash as part of the "info" parameter.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                   HKDF &lt;- Static Secret&lt;------+</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                  Extract</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       |                   |</td><td> </td><td class="right">                                       |                   |</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0084" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                      <span class="delete">PRF</span>                  |</td><td> </td><td class="rblock">     <span class="insert">Early Application               v                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Traffic Keys    &lt;-HKDFH--   Auth.                       |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                  Master                       |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                  Secret</span>                       |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       |                   |</td><td> </td><td class="right">                                       |                   |</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0085" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       <span class="delete">v                   |</span></td><td> </td><td class="rblock">             <span class="insert">0</span>                       |                         | Via</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">     Handshake   &lt;-PRF-           Handshake                |</span></td><td> </td><td class="rblock">             |                       |                         <span class="insert">|</span> Session</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    Traffic Keys                 Master Secret             |</span></td><td> </td><td class="rblock">            <span class="insert">HKDF &lt;--  Ephemeral --&gt; HKDF                       |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       |                   | Via</td><td> </td><td class="rblock"><span class="insert">          Extract      Secret     Extract</span>                      |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       |                   | Session</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                            <span class="delete">+----------+----------+</span>        | <span class="delete">Cache</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                            |                     |        |</td><td> </td><td class="right">                            |                     |        |</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0086" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                           <span class="delete">PRF                   PRF</span>       |</td><td> </td><td class="rblock">             <span class="insert">v                       |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">          Handshake                  |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           Master                    |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           Secret                    |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">             |                       |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        HKDF-Expand                  |</span>                         |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                            |                     |        |</td><td> </td><td class="right">                            |                     |        |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                            v                     v        |</td><td> </td><td class="right">                            v                     v        |</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0087" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">Application  &lt;-PRF-</span>  Master               <span class="delete">Resumption</span>   |</td><td> </td><td class="rblock">          <span class="insert">Handshake</span>                Master                      |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Traffic Keys          Secret               <span class="delete">Premaster  --+</span></td><td> </td><td class="rblock">        Traffic Keys               Secret                      <span class="insert">|</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     |                         |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         Application    &lt;--HKDF------+-----HKDF---&gt;        Resumption</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        Traffic Keys      Expand     |    Expand             Master</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     |                       Secret</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                     |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">           Exporter     &lt;--HKDF------+</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">            Master        Expand</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                Secret</td><td> </td><td class="right">                                                Secret</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0088" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">First, as soon as the ClientKeyShare and ServerKeyShare messages have</span></td><td> </td><td class="rblock">   <span class="insert">The</span> key <span class="insert">derivation process below</span> is <span class="insert">described in the order that</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   been exchanged, the client and server each use the unauthenticated</span></td><td> </td><td class="rblock"><span class="insert">   values are computed</span> for the <span class="insert">1-RTT handshake.  In the 0-RTT handshake</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   key <span class="delete">shares to generate a master secret which</span> is <span class="delete">used</span> for the</td><td> </td><td class="rblock"><span class="insert">   the AMS is computed first in order to derive the Early Application</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">protection of</span> the <span class="delete">remaining</span> handshake <span class="delete">records.  Specifically, they</span></td><td> </td><td class="rblock"><span class="insert">   Traffic Keys (see Section [TODO]).  However, in either case the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   generate:</span></td><td> </td><td class="rblock"><span class="insert">   computations are the same.  [[OPEN ISSUE: One unattractive feature</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">   here is that we don't get to encrypt</span> the handshake <span class="insert">under PSK even if</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    hs_master_secret = PRF(pre_master_secret, "handshake master secret",</span></td><td> </td><td class="rblock"><span class="insert">   it's available.]]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                           session_hash)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                           [0..47];</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0089" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">During resumption,</span> the <span class="delete">premaster secret</span> is <span class="delete">initialized with the</span></td><td> </td><td class="rblock">   <span class="insert">Once</span> the <span class="insert">ClientKeyShare and ServerKeyShare have been exchanged, ES</span> is</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   "resumption premaster secret", rather than using</span> the <span class="delete">values from the</span></td><td> </td><td class="rblock">   <span class="insert">computed and used to compute</span> the <span class="insert">handshake master secret (HMS).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   ClientKeyShare/ServerKeyShare exchange.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0090" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   This master secret value is used to <span class="delete">generate</span> the record protection</td><td> </td><td class="rblock">      <span class="insert">HMS = HKDF-Extract(0, ES)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   This master secret value is used to <span class="insert">compute</span> the record protection</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   keys used for the handshake, as described in Section 6.3.</td><td> </td><td class="right">   keys used for the handshake, as described in Section 6.3.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0091" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Once the <span class="delete">hs_master_secret</span> has been <span class="delete">computed,</span> the <span class="delete">premaster</span> secret</td><td> </td><td class="rblock">   Once the <span class="insert">ServerParameters message</span> has been <span class="insert">exchanged, SS is computed</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">SHOULD be deleted from memory.</span></td><td> </td><td class="rblock"><span class="insert">   based on</span> the <span class="insert">client's ephemeral key share in the ServerKeyShare and</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the server_key value of the ServerParameters.  SS is used as input to</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   the rest of the key schedule, starting with the authentication master</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   secret <span class="insert">(AMS):</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0092" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Once the last non-Finished message has been sent, the client and</span></td><td> </td><td class="rblock">      <span class="insert">AMS = HKDF-Extract(0, SS)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   server then compute the master secret which will be used for the</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   remainder of the session.  It is also used with TLS Exporters</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   [RFC5705].</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0093" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">master_secret = PRF(hs_master_secret, "extended master secret",</span></td><td> </td><td class="rblock">   <span class="insert">Once the AMS has been computed, SS SHOULD be deleted from memory.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                          session_hash)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                          [0..47];</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0094" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   If the server does not request client authentication, the <span class="delete">master</span></td><td> </td><td class="rblock">   <span class="insert">AMS is used to compute for three purposes:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   secret</span> can be <span class="delete">computed</span> at the time that the server sends its</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Finished, thus allowing the server to send traffic on its first</td><td> </td><td class="rblock"><span class="insert">   1.  To compute the Master Secret.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   2.  As the master secret to compute record protection keys for 0-RTT</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       application data.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   3.  To compute the key for the Finished message.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Once both AMS and ES are available, the client can then compute the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Master Secret (MS):</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      MS = HKDF-Extract(AMS, ES)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   If ES is not available, then a SecurityParameters.kdf_length string</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of 0s is used.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   This master secret value is used for three purposes:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   1.  To compute the final application traffic protection keys, as</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       described in Section 6.3.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   2.  To compute the resumption master secret (RMS) as described below.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   3.  To compute the exporter master secret (EMS) as described below.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   If the server does not request client authentication, the <span class="insert">rest of</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   these computations</span> can be <span class="insert">performed</span> at the time that the server sends</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   its Finished, thus allowing the server to send traffic on its first</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   flight (see [TODO] for security considerations on this practice.)  If</td><td> </td><td class="right">   flight (see [TODO] for security considerations on this practice.)  If</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0095" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the server requests client authentication, th<span class="delete">is secret</span> can be</td><td> </td><td class="rblock">   the server requests client authentication, th<span class="insert">ese computations</span> can be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   computed after the client's Certificate and CertificateVerify have</td><td> </td><td class="right">   computed after the client's Certificate and CertificateVerify have</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   been sent, or, if the client refuses client authentication, after the</td><td> </td><td class="right">   been sent, or, if the client refuses client authentication, after the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   client's empty Certificate message has been sent.</td><td> </td><td class="right">   client's empty Certificate message has been sent.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0096" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">For full handshakes, each side also derives a new</span> secret <span class="delete">which will</span></td><td> </td><td class="rblock">   <span class="insert">The exporter master</span> secret <span class="insert">(EMS)</span> is computed as:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   be used as the premaster_secret for future resumptions of the newly</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   established session.  This</span> is computed as:</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0097" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">resumption_premaster_secret</span> = <span class="delete">PRF(hs_master_secret,</span></td><td> </td><td class="rblock">      <span class="insert">EMS</span> = <span class="insert">HKDF-Expand(MS, "exporter master secret" + session_hash,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                        "resumption premaster secret",</span></td><td> </td><td class="rblock"><span class="insert">                        SecurityParameters.kdf_length)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                        session_hash)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                        [0..47];</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0098" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   The session_hash value is a running hash of the handshake as defined</td><td> </td><td class="rblock">   <span class="insert">In full handshakes a resumption master secret (RMS) is computed as:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   in Section <span class="delete">8.1.1.  Thus, the hs_master_secret is generated using a</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   different session_hash from the other two secrets.</span></td><td> </td><td class="rblock"><span class="insert">      RMS = HKDF-Expand(MS, "resumption master secret" + session_hash,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                        SecurityParameters.kdf_length)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   The session_hash value is a running hash of the handshake <span class="insert">at the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   current point,</span> as defined in Section <span class="insert">8.1.1</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   All master secrets are always exactly 48 bytes in length.  The length</td><td> </td><td class="right">   All master secrets are always exactly 48 bytes in length.  The length</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0099" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   of <span class="delete">the premaster secret</span> will vary depending on key exchange method.</td><td> </td><td class="rblock">   of <span class="insert">SS and ES</span> will vary depending on key exchange method.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">8.1.1.  The Session Hash</td><td> </td><td class="right">8.1.1.  The Session Hash</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When a handshake takes place, we define</td><td> </td><td class="right">   When a handshake takes place, we define</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        session_hash = Hash(handshake_messages)</td><td> </td><td class="right">        session_hash = Hash(handshake_messages)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   where "handshake_messages" refers to all handshake messages sent or</td><td> </td><td class="right">   where "handshake_messages" refers to all handshake messages sent or</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   received, starting at client hello up to the present time, with the</td><td> </td><td class="right">   received, starting at client hello up to the present time, with the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   exception of the Finished message, including the type and length</td><td> </td><td class="right">   exception of the Finished message, including the type and length</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   fields of the handshake messages.  This is the concatenation of all</td><td> </td><td class="right">   fields of the handshake messages.  This is the concatenation of all</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the exchanged Handshake structures.</td><td> </td><td class="right">   the exchanged Handshake structures.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0100" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   For concreteness, at the point where the handshake <span class="delete">master secret is</span></td><td> </td><td class="rblock">   For concreteness, at the point where the handshake <span class="insert">traffic keys are</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   derived, the session hash includes the ClientHello, ClientKeyShare,</td><td> </td><td class="right">   derived, the session hash includes the ClientHello, ClientKeyShare,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ServerHello, and ServerKeyShare, and HelloRetryRequest (if any)</td><td> </td><td class="right">   ServerHello, and ServerKeyShare, and HelloRetryRequest (if any)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   (though see [https://github.com/tlswg/tls13-spec/issues/104]).  At</td><td> </td><td class="right">   (though see [https://github.com/tlswg/tls13-spec/issues/104]).  At</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0101" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the point where the master secret <span class="delete">is</span> derived, it includes every</td><td> </td><td class="rblock">   the point where the <span class="insert">finished secret, application traffic keys,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   handshake message, with the exception of the Finished messages.  Note</td><td> </td><td class="rblock"><span class="insert">   exporter master secret, and resuption</span> master secret <span class="insert">are</span> derived, it</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   that if client authentication is not used, then the session hash is</td><td> </td><td class="rblock">   includes every handshake message, with the exception of the Finished</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   complete at the point when the server has sent its first flight.</td><td> </td><td class="rblock">   messages.  Note that if client authentication is not used, then the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Otherwise, it is only complete when the client has sent its first</td><td> </td><td class="rblock">   session hash is complete at the point when the server has sent its</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   flight, as it covers the client's Certificate and CertificateVerify.</td><td> </td><td class="rblock">   first flight.  Otherwise, it is only complete when the client has</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   sent its first flight, as it covers the client's Certificate and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   CertificateVerify.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">8.1.2.  Diffie-Hellman</td><td> </td><td class="right">8.1.2.  Diffie-Hellman</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   A conventional Diffie-Hellman computation is performed.  The</td><td> </td><td class="right">   A conventional Diffie-Hellman computation is performed.  The</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0102" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   negotiated key (Z) is used as the <span class="delete">pre_master_secret,</span> and is converted</td><td> </td><td class="rblock">   negotiated key (Z) is used as the <span class="insert">shared_secret,</span> and is converted</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   into the <span class="delete">master_secret,</span> as specified above.  Leading bytes of Z that</td><td> </td><td class="rblock">   into the <span class="insert">master secrets,</span> as specified above.  Leading bytes of Z that</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   contain all zero bits are stripped before it is used as the</td><td> </td><td class="rblock">   contain all zero bits are stripped before it is used as the <span class="insert">input to</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">pre_master_secret.</span></td><td> </td><td class="rblock"><span class="insert">   the key computations.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">8.1.3.  Elliptic Curve Diffie-Hellman</td><td> </td><td class="right">8.1.3.  Elliptic Curve Diffie-Hellman</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   All ECDH calculations (including parameter and key generation as well</td><td> </td><td class="right">   All ECDH calculations (including parameter and key generation as well</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   as the shared secret calculation) are performed according to [6]</td><td> </td><td class="right">   as the shared secret calculation) are performed according to [6]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   using the ECKAS-DH1 scheme with the identity map as key derivation</td><td> </td><td class="right">   using the ECKAS-DH1 scheme with the identity map as key derivation</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0103" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   function (KDF), so that the <span class="delete">premaster</span> secret is the x-coordinate of</td><td> </td><td class="rblock">   function (KDF), so that the <span class="insert">shared</span> secret is the x-coordinate of the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the ECDH shared secret elliptic curve point represented as an octet</td><td> </td><td class="rblock">   ECDH shared secret elliptic curve point represented as an octet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   string.  Note that this octet string (Z in IEEE 1363 terminology) as</td><td> </td><td class="right">   string.  Note that this octet string (Z in IEEE 1363 terminology) as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   output by FE2OSP, the Field Element to Octet String Conversion</td><td> </td><td class="right">   output by FE2OSP, the Field Element to Octet String Conversion</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Primitive, has constant length for any given field; leading zeros</td><td> </td><td class="right">   Primitive, has constant length for any given field; leading zeros</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   found in this octet string MUST NOT be truncated.</td><td> </td><td class="right">   found in this octet string MUST NOT be truncated.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   (Note that this use of the identity KDF is a technicality.  The</td><td> </td><td class="right">   (Note that this use of the identity KDF is a technicality.  The</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   complete picture is that ECDH is employed with a non-trivial KDF</td><td> </td><td class="right">   complete picture is that ECDH is employed with a non-trivial KDF</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0104" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   because TLS does not directly use <span class="delete">the premaster</span> secret for anything</td><td> </td><td class="rblock">   because TLS does not directly use <span class="insert">this</span> secret for anything other than</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   other than for computing <span class="delete">the master secret.)</span></td><td> </td><td class="rblock">   for computing <span class="insert">other secrets.)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">9.  Mandatory Cipher Suites</td><td> </td><td class="right">9.  Mandatory Cipher Suites</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   In the absence of an application profile standard specifying</td><td> </td><td class="right">   In the absence of an application profile standard specifying</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   otherwise, a TLS-compliant application MUST implement the cipher</td><td> </td><td class="right">   otherwise, a TLS-compliant application MUST implement the cipher</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   suite TODO:Needs to be selected [1].  (See Appendix A.4 for the</td><td> </td><td class="right">   suite TODO:Needs to be selected [1].  (See Appendix A.4 for the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   definition).</td><td> </td><td class="right">   definition).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">10.  Application Data Protocol</td><td> </td><td class="right">10.  Application Data Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l20" /><small>skipping to change at</small><em> page 64, line 25</em></th><th> </th><th><a name="part-r20" /><small>skipping to change at</small><em> page 66, line 9</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              April 2002.</td><td> </td><td class="right">              April 2002.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [RFC3447]  Jonsson, J. and B. Kaliski, "Public-Key Cryptography</td><td> </td><td class="right">   [RFC3447]  Jonsson, J. and B. Kaliski, "Public-Key Cryptography</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              Standards (PKCS) #1: RSA Cryptography Specifications</td><td> </td><td class="right">              Standards (PKCS) #1: RSA Cryptography Specifications</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              Version 2.1", RFC 3447, February 2003.</td><td> </td><td class="right">              Version 2.1", RFC 3447, February 2003.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [RFC5288]  Salowey, J., Choudhury, A., and D. McGrew, "AES Galois</td><td> </td><td class="right">   [RFC5288]  Salowey, J., Choudhury, A., and D. McGrew, "AES Galois</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              Counter Mode (GCM) Cipher Suites for TLS", RFC 5288,</td><td> </td><td class="right">              Counter Mode (GCM) Cipher Suites for TLS", RFC 5288,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              August 2008.</td><td> </td><td class="right">              August 2008.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0105" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">[RFC5869]  Krawczyk, H. and P. Eronen, "HMAC-based Extract-and-Expand</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              Key Derivation Function (HKDF)", RFC 5869, May 2010.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [SCH]      Schneier, B., "Applied Cryptography: Protocols,</td><td> </td><td class="right">   [SCH]      Schneier, B., "Applied Cryptography: Protocols,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              Algorithms, and Source Code in C, 2nd ed.", 1996.</td><td> </td><td class="right">              Algorithms, and Source Code in C, 2nd ed.", 1996.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [SHS]      National Institute of Standards and Technology, U.S.</td><td> </td><td class="right">   [SHS]      National Institute of Standards and Technology, U.S.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              Department of Commerce, "Secure Hash Standard", NIST FIPS</td><td> </td><td class="right">              Department of Commerce, "Secure Hash Standard", NIST FIPS</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              PUB 180-2, August 2002.</td><td> </td><td class="right">              PUB 180-2, August 2002.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [TRIPLEDES]</td><td> </td><td class="right">   [TRIPLEDES]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              National Institute of Standards and Technology,</td><td> </td><td class="right">              National Institute of Standards and Technology,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              "Recommendation for the Triple Data Encryption Algorithm</td><td> </td><td class="right">              "Recommendation for the Triple Data Encryption Algorithm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l21" /><small>skipping to change at</small><em> page 69, line 20</em></th><th> </th><th><a name="part-r21" /><small>skipping to change at</small><em> page 70, line 20</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8 major;</td><td> </td><td class="right">          uint8 major;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8 minor;</td><td> </td><td class="right">          uint8 minor;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } ProtocolVersion;</td><td> </td><td class="right">      } ProtocolVersion;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      ProtocolVersion version = { 3, 4 };     /* TLS v1.3*/</td><td> </td><td class="right">      ProtocolVersion version = { 3, 4 };     /* TLS v1.3*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum {</td><td> </td><td class="right">      enum {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          reserved(20), alert(21), handshake(22),</td><td> </td><td class="right">          reserved(20), alert(21), handshake(22),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0106" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          application_data(23), (255)</td><td> </td><td class="rblock">          application_data(23),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">          (255)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } ContentType;</td><td> </td><td class="right">      } ContentType;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ContentType type;</td><td> </td><td class="right">          ContentType type;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ProtocolVersion version;</td><td> </td><td class="right">          ProtocolVersion version;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint16 length;</td><td> </td><td class="right">          uint16 length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          opaque fragment[TLSPlaintext.length];</td><td> </td><td class="right">          opaque fragment[TLSPlaintext.length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } TLSPlaintext;</td><td> </td><td class="right">      } TLSPlaintext;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ContentType type;</td><td> </td><td class="right">          ContentType type;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ProtocolVersion version;</td><td> </td><td class="right">          ProtocolVersion version;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint16 length;</td><td> </td><td class="right">          uint16 length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0107" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">          opaque nonce_explicit[SecurityParameters.record_iv_length];</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          aead-ciphered struct {</td><td> </td><td class="right">          aead-ciphered struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">             opaque content[TLSPlaintext.length];</td><td> </td><td class="right">             opaque content[TLSPlaintext.length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          } fragment;</td><td> </td><td class="right">          } fragment;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } TLSCiphertext;</td><td> </td><td class="right">      } TLSCiphertext;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.2.  Alert Messages</td><td> </td><td class="right">A.2.  Alert Messages</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { warning(1), fatal(2), (255) } AlertLevel;</td><td> </td><td class="right">      enum { warning(1), fatal(2), (255) } AlertLevel;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum {</td><td> </td><td class="right">      enum {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          close_notify(0),</td><td> </td><td class="right">          close_notify(0),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l22" /><small>skipping to change at</small><em> page 71, line 8</em></th><th> </th><th><a name="part-r22" /><small>skipping to change at</small><em> page 72, line 8</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          AlertLevel level;</td><td> </td><td class="right">          AlertLevel level;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          AlertDescription description;</td><td> </td><td class="right">          AlertDescription description;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } Alert;</td><td> </td><td class="right">      } Alert;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.  Handshake Protocol</td><td> </td><td class="right">A.3.  Handshake Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum {</td><td> </td><td class="right">      enum {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          reserved(0), client_hello(1), server_hello(2),</td><td> </td><td class="right">          reserved(0), client_hello(1), server_hello(2),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          client_key_share(5), hello_retry_request(6),</td><td> </td><td class="right">          client_key_share(5), hello_retry_request(6),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          server_key_share(7), certificate(11), reserved(12),</td><td> </td><td class="right">          server_key_share(7), certificate(11), reserved(12),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0108" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          certificate_request(13), certificate_verify(15),</td><td> </td><td class="rblock">          certificate_request(13), <span class="insert">server_parameters(14),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          reserved(16), finished(20), (255)</td><td> </td><td class="rblock">          certificate_verify(15), reserved(16), finished(20), (255)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } HandshakeType;</td><td> </td><td class="right">      } HandshakeType;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          HandshakeType msg_type;    /* handshake type */</td><td> </td><td class="right">          HandshakeType msg_type;    /* handshake type */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint24 length;             /* bytes in message */</td><td> </td><td class="right">          uint24 length;             /* bytes in message */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          select (HandshakeType) {</td><td> </td><td class="right">          select (HandshakeType) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case client_hello:        ClientHello;</td><td> </td><td class="right">              case client_hello:        ClientHello;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case client_key_share:    ClientKeyShare;</td><td> </td><td class="right">              case client_key_share:    ClientKeyShare;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case server_hello:        ServerHello;</td><td> </td><td class="right">              case server_hello:        ServerHello;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case hello_retry_request: HelloRetryRequest;</td><td> </td><td class="right">              case hello_retry_request: HelloRetryRequest;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case server_key_share:    ServerKeyShare;</td><td> </td><td class="right">              case server_key_share:    ServerKeyShare;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case certificate:         Certificate;</td><td> </td><td class="right">              case certificate:         Certificate;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case certificate_request: CertificateRequest;</td><td> </td><td class="right">              case certificate_request: CertificateRequest;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0109" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              case server_parameters:   ServerParameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case certificate_verify:  CertificateVerify;</td><td> </td><td class="right">              case certificate_verify:  CertificateVerify;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              case finished:            Finished;</td><td> </td><td class="right">              case finished:            Finished;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          } body;</td><td> </td><td class="right">          } body;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } Handshake;</td><td> </td><td class="right">      } Handshake;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.1.  Hello Messages</td><td> </td><td class="right">A.3.1.  Hello Messages</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      opaque SessionID&lt;0..32&gt;;</td><td> </td><td class="right">      opaque SessionID&lt;0..32&gt;;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      uint8 CipherSuite[2];    /* Cryptographic suite selector */</td><td> </td><td class="right">      uint8 CipherSuite[2];    /* Cryptographic suite selector */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l23" /><small>skipping to change at</small><em> page 72, line 39</em></th><th> </th><th><a name="part-r23" /><small>skipping to change at</small><em> page 73, line 40</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } ExtensionType;</td><td> </td><td class="right">      } ExtensionType;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         struct {</td><td> </td><td class="right">         struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">           TLSCipherText messages&lt;5 .. 2^24-1&gt;;</td><td> </td><td class="right">           TLSCipherText messages&lt;5 .. 2^24-1&gt;;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         } EarlyDataExtension;</td><td> </td><td class="right">         } EarlyDataExtension;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          Extension extensions&lt;0..2^16-1&gt;;</td><td> </td><td class="right">          Extension extensions&lt;0..2^16-1&gt;;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } EncryptedExtensions;</td><td> </td><td class="right">      } EncryptedExtensions;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0110" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">      <span class="insert">struct {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        uint64 not_before;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        uint64 not_after;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        opaque key_identifier&lt;0..2^8-1&gt;;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        NamedGroup group;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">        opaque server_key&lt;1..2^16-1&gt;;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      } UnsignedParameters;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.1.1.  Signature Algorithm Extension</td><td> </td><td class="right">A.3.1.1.  Signature Algorithm Extension</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0111" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                                         </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum {</td><td> </td><td class="right">      enum {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          none(0), md5(1), sha1(2), sha224(3), sha256(4), sha384(5),</td><td> </td><td class="right">          none(0), md5(1), sha1(2), sha224(3), sha256(4), sha384(5),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          sha512(6), (255)</td><td> </td><td class="right">          sha512(6), (255)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } HashAlgorithm;</td><td> </td><td class="right">      } HashAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { anonymous(0), rsa(1), dsa(2), ecdsa(3), (255) }</td><td> </td><td class="right">      enum { anonymous(0), rsa(1), dsa(2), ecdsa(3), (255) }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        SignatureAlgorithm;</td><td> </td><td class="right">        SignatureAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            HashAlgorithm hash;</td><td> </td><td class="right">            HashAlgorithm hash;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l24" /><small>skipping to change at</small><em> page 75, line 8</em></th><th> </th><th><a name="part-r24" /><small>skipping to change at</small><em> page 76, line 8</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">           digitally-signed struct {</td><td> </td><td class="right">           digitally-signed struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               opaque handshake_messages_hash[hash_length];</td><td> </td><td class="right">               opaque handshake_messages_hash[hash_length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">           }</td><td> </td><td class="right">           }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } CertificateVerify;</td><td> </td><td class="right">      } CertificateVerify;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.4.  Handshake Finalization Messages</td><td> </td><td class="right">A.3.4.  Handshake Finalization Messages</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0112" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          opaque verify_data[<span class="delete">verify_data</span>_length];</td><td> </td><td class="rblock">          opaque verify_data[<span class="insert">SecurityParameters.kdf</span>_length];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } Finished;</td><td> </td><td class="right">      } Finished;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.4.  The Cipher Suite</td><td> </td><td class="right">A.4.  The Cipher Suite</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The following values define the cipher suite codes used in the</td><td> </td><td class="right">   The following values define the cipher suite codes used in the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ClientHello and ServerHello messages.</td><td> </td><td class="right">   ClientHello and ServerHello messages.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   A cipher suite defines a cipher specification supported in TLS</td><td> </td><td class="right">   A cipher suite defines a cipher specification supported in TLS</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Version 1.2.</td><td> </td><td class="right">   Version 1.2.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l25" /><small>skipping to change at</small><em> page 76, line 35</em></th><th> </th><th><a name="part-r25" /><small>skipping to change at</small><em> page 77, line 35</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [[TODO: Add all the defined AEAD ciphers.  This currently only lists</td><td> </td><td class="right">   [[TODO: Add all the defined AEAD ciphers.  This currently only lists</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   GCM. https://github.com/tlswg/tls13-spec/issues/53]] Note that using</td><td> </td><td class="right">   GCM. https://github.com/tlswg/tls13-spec/issues/53]] Note that using</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   non-anonymous key exchange without actually verifying the key</td><td> </td><td class="right">   non-anonymous key exchange without actually verifying the key</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   exchange is essentially equivalent to anonymous key exchange, and the</td><td> </td><td class="right">   exchange is essentially equivalent to anonymous key exchange, and the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   same precautions apply.  While non-anonymous key exchange will</td><td> </td><td class="right">   same precautions apply.  While non-anonymous key exchange will</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   generally involve a higher computational and communicational cost</td><td> </td><td class="right">   generally involve a higher computational and communicational cost</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   than anonymous key exchange, it may be in the interest of</td><td> </td><td class="right">   than anonymous key exchange, it may be in the interest of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   interoperability not to disable non-anonymous key exchange when the</td><td> </td><td class="right">   interoperability not to disable non-anonymous key exchange when the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   application layer is allowing anonymous key exchange.</td><td> </td><td class="right">   application layer is allowing anonymous key exchange.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0113" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   The <span class="delete">PR</span>Fs SHALL be as follows:</td><td> </td><td class="rblock">   The <span class="insert">KD</span>Fs SHALL be as follows:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0114" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   o For cipher suites ending with _SHA256, the <span class="delete">PRF</span> is <span class="delete">the TLS PRF</span> with</td><td> </td><td class="rblock">   o For cipher suites ending with _SHA256, the <span class="insert">KDF</span> is <span class="insert">HKDF</span> with SHA-256</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   SHA-256 as the hash function.</td><td> </td><td class="rblock">   as the hash function.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0115" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   o For cipher suites ending with _SHA384, the <span class="delete">PRF</span> is <span class="delete">the TLS PRF</span> with</td><td> </td><td class="rblock">   o For cipher suites ending with _SHA384, the <span class="insert">KDF</span> is <span class="insert">HKDF</span> with SHA-384</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   SHA-384 as the hash function.</td><td> </td><td class="rblock">   as the hash function.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   New cipher suite values are been assigned by IANA as described in</td><td> </td><td class="right">   New cipher suite values are been assigned by IANA as described in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Section 12.</td><td> </td><td class="right">   Section 12.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Note: The cipher suite values { 0x00, 0x1C } and { 0x00, 0x1D } are</td><td> </td><td class="right">   Note: The cipher suite values { 0x00, 0x1C } and { 0x00, 0x1D } are</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   reserved to avoid collision with Fortezza-based cipher suites in SSL</td><td> </td><td class="right">   reserved to avoid collision with Fortezza-based cipher suites in SSL</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   3.</td><td> </td><td class="right">   3.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.5.  The Security Parameters</td><td> </td><td class="right">A.5.  The Security Parameters</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   These security parameters are determined by the TLS Handshake</td><td> </td><td class="right">   These security parameters are determined by the TLS Handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Protocol and provided as parameters to the TLS record layer in order</td><td> </td><td class="right">   Protocol and provided as parameters to the TLS record layer in order</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   to initialize a connection state.  SecurityParameters includes:</td><td> </td><td class="right">   to initialize a connection state.  SecurityParameters includes:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { server, client } ConnectionEnd;</td><td> </td><td class="right">      enum { server, client } ConnectionEnd;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0116" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      enum { <span class="delete">tls_prf_sha256 } PR</span>FAlgorithm;</td><td> </td><td class="rblock">      enum { <span class="insert">sha256, sha384 } KD</span>FAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      enum { aes_gcm } RecordProtAlgorithm;</td><td> </td><td class="right">      enum { aes_gcm } RecordProtAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0117" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* The algorithms specified in <span class="delete">PR</span>FAlgorithm and</td><td> </td><td class="rblock">      /* The algorithms specified in <span class="insert">KD</span>FAlgorithm and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         RecordProtAlgorithm may be added to. */</td><td> </td><td class="right">         RecordProtAlgorithm may be added to. */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      struct {</td><td> </td><td class="right">      struct {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          ConnectionEnd          entity;</td><td> </td><td class="right">          ConnectionEnd          entity;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0118" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          <span class="delete">PRFAlgorithm           prf_algorithm;</span></td><td> </td><td class="rblock">          <span class="insert">KDFAlgorithm           kdf_algorithm;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">          uint8                  kdf_length;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          RecordProtAlgorithm    record_prot_algorithm;</td><td> </td><td class="right">          RecordProtAlgorithm    record_prot_algorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8                  enc_key_length;</td><td> </td><td class="right">          uint8                  enc_key_length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          uint8                  block_length;</td><td> </td><td class="right">          uint8                  block_length;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0119" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          <span class="delete">uint8                  fixed_iv_length;</span></td><td> </td><td class="rblock">          opaque                 <span class="insert">auth_master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">          uint8                  record_iv_length;</span></td><td> </td><td class="rblock">          opaque                 <span class="insert">hs_master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          opaque                 <span class="delete">hs_master_secret[48];</span></td><td> </td><td class="rblock"><span class="insert">          opaque                 master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          opaque                 <span class="delete">master_secret[48];</span></td><td> </td><td class="rblock"><span class="insert">          opaque                 exporter_master_secret[kdf_length];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          opaque                 client_random[32];</td><td> </td><td class="right">          opaque                 client_random[32];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          opaque                 server_random[32];</td><td> </td><td class="right">          opaque                 server_random[32];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      } SecurityParameters;</td><td> </td><td class="right">      } SecurityParameters;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.6.  Changes to RFC 4492</td><td> </td><td class="right">A.6.  Changes to RFC 4492</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   RFC 4492 [RFC4492] adds Elliptic Curve cipher suites to TLS.  This</td><td> </td><td class="right">   RFC 4492 [RFC4492] adds Elliptic Curve cipher suites to TLS.  This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   document changes some of the structures used in that document.  This</td><td> </td><td class="right">   document changes some of the structures used in that document.  This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   section details the required changes for implementors of both RFC</td><td> </td><td class="right">   section details the required changes for implementors of both RFC</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   4492 and TLS 1.2.  Implementors of TLS 1.2 who are not implementing</td><td> </td><td class="right">   4492 and TLS 1.2.  Implementors of TLS 1.2 who are not implementing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l26" /><small>skipping to change at</small><em> page 79, line 26</em></th><th> </th><th><a name="part-r26" /><small>skipping to change at</small><em> page 80, line 26</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   digital signatures</td><td> </td><td class="right">   digital signatures</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Digital signatures utilize public key cryptography and one-way</td><td> </td><td class="right">      Digital signatures utilize public key cryptography and one-way</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      hash functions to produce a signature of the data that can be</td><td> </td><td class="right">      hash functions to produce a signature of the data that can be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      authenticated, and is difficult to forge or repudiate.</td><td> </td><td class="right">      authenticated, and is difficult to forge or repudiate.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   handshake</td><td> </td><td class="right">   handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      An initial negotiation between client and server that establishes</td><td> </td><td class="right">      An initial negotiation between client and server that establishes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      the parameters of their transactions.</td><td> </td><td class="right">      the parameters of their transactions.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0120" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Initialization Vector (IV)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      Some AEAD ciphers require an initialization vector to allow the</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      cipher to safely protect multiple chunks of data with the same</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      keying material.  The size of the IV depends on the cipher suite.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Message Authentication Code (MAC)</td><td> </td><td class="right">   Message Authentication Code (MAC)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      A Message Authentication Code is a one-way hash computed from a</td><td> </td><td class="right">      A Message Authentication Code is a one-way hash computed from a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      message and some secret data.  It is difficult to forge without</td><td> </td><td class="right">      message and some secret data.  It is difficult to forge without</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      knowing the secret data.  Its purpose is to detect if the message</td><td> </td><td class="right">      knowing the secret data.  Its purpose is to detect if the message</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      has been altered.</td><td> </td><td class="right">      has been altered.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   master secret</td><td> </td><td class="right">   master secret</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0121" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Secure secret data used for generating keys<span class="delete"> and IVs</span>.</td><td> </td><td class="rblock">      Secure secret data used for generating keys.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   MD5</td><td> </td><td class="right">   MD5</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      MD5 [RFC1321] is a hashing function that converts an arbitrarily</td><td> </td><td class="right">      MD5 [RFC1321] is a hashing function that converts an arbitrarily</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      long data stream into a hash of fixed size (16 bytes).  Due to</td><td> </td><td class="right">      long data stream into a hash of fixed size (16 bytes).  Due to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      significant progress in cryptanalysis, at the time of publication</td><td> </td><td class="right">      significant progress in cryptanalysis, at the time of publication</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      of this document, MD5 no longer can be considered a 'secure'</td><td> </td><td class="right">      of this document, MD5 no longer can be considered a 'secure'</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      hashing function.</td><td> </td><td class="right">      hashing function.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   public key cryptography</td><td> </td><td class="right">   public key cryptography</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      A class of cryptographic techniques employing two-key ciphers.</td><td> </td><td class="right">      A class of cryptographic techniques employing two-key ciphers.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l27" /><small>skipping to change at</small><em> page 81, line 8</em></th><th> </th><th><a name="part-r27" /><small>skipping to change at</small><em> page 82, line 8</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SSL Version 3.0.</td><td> </td><td class="right">      SSL Version 3.0.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Transport Layer Security (TLS)</td><td> </td><td class="right">   Transport Layer Security (TLS)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      This protocol; also, the Transport Layer Security working group of</td><td> </td><td class="right">      This protocol; also, the Transport Layer Security working group of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      the Internet Engineering Task Force (IETF).  See "Working Group</td><td> </td><td class="right">      the Internet Engineering Task Force (IETF).  See "Working Group</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Information" at the end of this document (see page 99).</td><td> </td><td class="right">      Information" at the end of this document (see page 99).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Appendix C.  Cipher Suite Definitions</td><td> </td><td class="right">Appendix C.  Cipher Suite Definitions</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Cipher Suite                          Key        Record</td><td> </td><td class="right">   Cipher Suite                          Key        Record</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0122" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                         Exchange   Protection   <span class="delete">PR</span>F</td><td> </td><td class="rblock">                                         Exchange   Protection   <span class="insert">KD</span>F</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_NULL_WITH_NULL_NULL               NULL       NULL_NULL    N/A</td><td> </td><td class="right">   TLS_NULL_WITH_NULL_NULL               NULL       NULL_NULL    N/A</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_DHE_RSA_WITH_AES_128_GCM_SHA256   DHE_RSA    AES_128_GCM  SHA256</td><td> </td><td class="right">   TLS_DHE_RSA_WITH_AES_128_GCM_SHA256   DHE_RSA    AES_128_GCM  SHA256</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_DHE_RSA_WITH_AES_256_GCM_SHA384   DHE_RSA    AES_256_GCM  SHA384</td><td> </td><td class="right">   TLS_DHE_RSA_WITH_AES_256_GCM_SHA384   DHE_RSA    AES_256_GCM  SHA384</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_DHE_DSS_WITH_AES_128_GCM_SHA256   DHE_DSS    AES_128_GCM  SHA256</td><td> </td><td class="right">   TLS_DHE_DSS_WITH_AES_128_GCM_SHA256   DHE_DSS    AES_128_GCM  SHA256</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_DHE_DSS_WITH_AES_256_GCM_SHA384   DHE_DSS    AES_256_GCM  SHA384</td><td> </td><td class="right">   TLS_DHE_DSS_WITH_AES_256_GCM_SHA384   DHE_DSS    AES_256_GCM  SHA384</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_DH_anon_WITH_AES_128_GCM_SHA256   DH_anon    AES_128_GCM  SHA256</td><td> </td><td class="right">   TLS_DH_anon_WITH_AES_128_GCM_SHA256   DH_anon    AES_128_GCM  SHA256</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS_DH_anon_WITH_AES_256_GCM_SHA384   DH_anon    AES_128_GCM  SHA384</td><td> </td><td class="right">   TLS_DH_anon_WITH_AES_256_GCM_SHA384   DH_anon    AES_128_GCM  SHA384</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0123" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   <span class="delete">Key      Implicit IV   Explicit IV</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   Cipher         Material  Size          Size</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   ------------   --------  ----------    -----------</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   NULL               0          0             0</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   AES_128_GCM       16          4             8</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   AES_256_GCM       32          4             8</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Key Material</td><td> </td><td class="right">   Key Material</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The number of bytes from the key_block that are used for</td><td> </td><td class="right">      The number of bytes from the key_block that are used for</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      generating the write keys.</td><td> </td><td class="right">      generating the write keys.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0124" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Implicit IV Size</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      The amount of data to be generated for the per-connection part of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      the initialization vector.  This is equal to</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      SecurityParameters.fixed_iv_length).</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   Explicit IV Size</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      The amount of data needed to be generated for the per-record part</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      of the initialization vector.  This is equal to</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      SecurityParameters.record_iv_length).</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Appendix D.  Implementation Notes</td><td> </td><td class="right">Appendix D.  Implementation Notes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The TLS protocol cannot prevent many common security mistakes.  This</td><td> </td><td class="right">   The TLS protocol cannot prevent many common security mistakes.  This</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   section provides several recommendations to assist implementors.</td><td> </td><td class="right">   section provides several recommendations to assist implementors.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">D.1.  Random Number Generation and Seeding</td><td> </td><td class="right">D.1.  Random Number Generation and Seeding</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   TLS requires a cryptographically secure pseudorandom number generator</td><td> </td><td class="right">   TLS requires a cryptographically secure pseudorandom number generator</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   (PRNG).  Care must be taken in designing and seeding PRNGs.  PRNGs</td><td> </td><td class="right">   (PRNG).  Care must be taken in designing and seeding PRNGs.  PRNGs</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   based on secure hash operations, most notably SHA-1, are acceptable,</td><td> </td><td class="right">   based on secure hash operations, most notably SHA-1, are acceptable,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l28" /><small>skipping to change at</small><em> page 83, line 24</em></th><th> </th><th><a name="part-r28" /><small>skipping to change at</small><em> page 84, line 4</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Section 7.3.9)?</td><td> </td><td class="right">      Section 7.3.9)?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Cryptographic details:</td><td> </td><td class="right">   Cryptographic details:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  What countermeasures do you use to prevent timing attacks against</td><td> </td><td class="right">   -  What countermeasures do you use to prevent timing attacks against</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      RSA signing operations [TIMING].</td><td> </td><td class="right">      RSA signing operations [TIMING].</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  When verifying RSA signatures, do you accept both NULL and missing</td><td> </td><td class="right">   -  When verifying RSA signatures, do you accept both NULL and missing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      parameters (see Section 4.7)?  Do you verify that the RSA padding</td><td> </td><td class="right">      parameters (see Section 4.7)?  Do you verify that the RSA padding</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      doesn't have additional data after the hash value?  [FI06]</td><td> </td><td class="right">      doesn't have additional data after the hash value?  [FI06]</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0125" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                                                         </span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  When using Diffie-Hellman key exchange, do you correctly strip</td><td> </td><td class="right">   -  When using Diffie-Hellman key exchange, do you correctly strip</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      leading zero bytes from the negotiated key (see Section 8.1.2)?</td><td> </td><td class="right">      leading zero bytes from the negotiated key (see Section 8.1.2)?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Does your TLS client check that the Diffie-Hellman parameters sent</td><td> </td><td class="right">   -  Does your TLS client check that the Diffie-Hellman parameters sent</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0126" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      by the server are acceptable (see Appendix F.1.1.<span class="delete">2</span>)?</td><td> </td><td class="rblock">      by the server are acceptable (see Appendix F.1.1.<span class="insert">3</span>)?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   -  Do you use a strong and, most importantly, properly seeded random</td><td> </td><td class="right">   -  Do you use a strong and, most importantly, properly seeded random</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      number generator (see Appendix D.1) Diffie-Hellman private values,</td><td> </td><td class="right">      number generator (see Appendix D.1) Diffie-Hellman private values,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      the DSA "k" parameter, and other security-critical values?</td><td> </td><td class="right">      the DSA "k" parameter, and other security-critical values?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Appendix E.  Backward Compatibility</td><td> </td><td class="right">Appendix E.  Backward Compatibility</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">E.1.  Compatibility with prior versions</td><td> </td><td class="right">E.1.  Compatibility with prior versions</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [[TODO: Revise backward compatibility section for TLS 1.3.</td><td> </td><td class="right">   [[TODO: Revise backward compatibility section for TLS 1.3.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l29" /><small>skipping to change at</small><em> page 86, line 19</em></th><th> </th><th><a name="part-r29" /><small>skipping to change at</small><em> page 86, line 49</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   total anonymity.  Whenever the server is authenticated, the channel</td><td> </td><td class="right">   total anonymity.  Whenever the server is authenticated, the channel</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   is secure against man-in-the-middle attacks, but completely anonymous</td><td> </td><td class="right">   is secure against man-in-the-middle attacks, but completely anonymous</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   sessions are inherently vulnerable to such attacks.  Anonymous</td><td> </td><td class="right">   sessions are inherently vulnerable to such attacks.  Anonymous</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   servers cannot authenticate clients.  If the server is authenticated,</td><td> </td><td class="right">   servers cannot authenticate clients.  If the server is authenticated,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   its certificate message must provide a valid certificate chain</td><td> </td><td class="right">   its certificate message must provide a valid certificate chain</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   leading to an acceptable certificate authority.  Similarly,</td><td> </td><td class="right">   leading to an acceptable certificate authority.  Similarly,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   authenticated clients must supply an acceptable certificate to the</td><td> </td><td class="right">   authenticated clients must supply an acceptable certificate to the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   server.  Each party is responsible for verifying that the other's</td><td> </td><td class="right">   server.  Each party is responsible for verifying that the other's</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   certificate is valid and has not expired or been revoked.</td><td> </td><td class="right">   certificate is valid and has not expired or been revoked.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0127" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   The general goal of the key exchange process is to create a</td><td> </td><td class="rblock">   The general goal of the key exchange process is to create a <span class="insert">master</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">pre_master_secret</span> known to the communicating parties and not to</td><td> </td><td class="rblock"><span class="insert">   secret</span> known to the communicating parties and not to <span class="insert">attackers</span> (see</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">attackers.  The pre_master_secret will be used to generate the</span></td><td> </td><td class="rblock">   Section 8.1).  The <span class="insert">master secret</span> is required to generate the record</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   master_secret</span> (see Section 8.1).  The <span class="delete">master_secret</span> is required to</td><td> </td><td class="rblock">   protection keys (see Section 7.3.8 and Section 6.3).  By sending a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   generate the <span class="delete">Finished messages and</span> record protection keys (see</td><td> </td><td class="rblock">   correct Finished message, parties thus prove that they know the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Section 7.3.8 and Section 6.3).  By sending a correct Finished</td><td> </td><td class="rblock">   correct <span class="insert">master secret and bind the ephemeral keys to the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   message, parties thus prove that they know the correct</td><td> </td><td class="rblock"><span class="insert">   authentication secret.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">pre_master_secret.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0128" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">F.1.1.1.  Anonymous Key Exchange</td><td> </td><td class="rblock">F.1.1.1.  <span class="insert">HKDF</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The separation of HKDF into its two components, HKDF-Extract and</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   HKDF-Expand as used in this specification has two main purposes: (i)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Highlight the uses of HKDF-Expand as a pseudo-random function (PRF)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   in the cases where a strong (uniform) key is available and without</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   need for further extraction, and (ii) to accommodate the derivation</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   of multiple keys out of a single extracted key, e.g. when deriving</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   multiple keys using MS.  We note that care needs to be applied when</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   using this separation.  The output of HKDF-Extract SHOULD only be</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   used for generating further keys via HKDF-Expand and never as a</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   terminal key (i.e., never as a leaf in the key derivation tree).  In</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   particular, context information in the form of label+seed is only</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   attached to the HKDF-Expand inputs not to that of HKDF-Extract.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">F.1.1.2.</span>  Anonymous Key Exchange</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Completely anonymous sessions can be established using Diffie-Hellman</td><td> </td><td class="right">   Completely anonymous sessions can be established using Diffie-Hellman</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   for key exchange.  The server's public parameters are contained in</td><td> </td><td class="right">   for key exchange.  The server's public parameters are contained in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the server key share message, and the client's are sent in the client</td><td> </td><td class="right">   the server key share message, and the client's are sent in the client</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   key share message.  Eavesdroppers who do not know the private values</td><td> </td><td class="right">   key share message.  Eavesdroppers who do not know the private values</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   should not be able to find the Diffie-Hellman result (i.e., the</td><td> </td><td class="right">   should not be able to find the Diffie-Hellman result (i.e., the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0129" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   pre<span class="delete">_master_</span>secret).</td><td> </td><td class="rblock">   pre<span class="insert">master </span>secret).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Warning: Completely anonymous connections only provide protection</td><td> </td><td class="right">   Warning: Completely anonymous connections only provide protection</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   against passive eavesdropping.  Unless an independent tamper-proof</td><td> </td><td class="right">   against passive eavesdropping.  Unless an independent tamper-proof</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   channel is used to verify that the Finished messages were not</td><td> </td><td class="right">   channel is used to verify that the Finished messages were not</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   replaced by an attacker, server authentication is required in</td><td> </td><td class="right">   replaced by an attacker, server authentication is required in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   environments where active man-in-the-middle attacks are a concern.</td><td> </td><td class="right">   environments where active man-in-the-middle attacks are a concern.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0130" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">F.1.1.<span class="delete">2</span>.  Diffie-Hellman Key Exchange with Authentication</td><td> </td><td class="rblock">F.1.1.<span class="insert">3</span>.  Diffie-Hellman Key Exchange with Authentication</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When Diffie-Hellman key exchange is used, the client and server use</td><td> </td><td class="right">   When Diffie-Hellman key exchange is used, the client and server use</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the client key exchange and server key exchange messages to send</td><td> </td><td class="right">   the client key exchange and server key exchange messages to send</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   temporary Diffie-Hellman parameters.  The signature in the</td><td> </td><td class="right">   temporary Diffie-Hellman parameters.  The signature in the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   certificate verify message (if present) covers the entire handshake</td><td> </td><td class="right">   certificate verify message (if present) covers the entire handshake</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   up to that point and thus attests the certificate holder's desire to</td><td> </td><td class="right">   up to that point and thus attests the certificate holder's desire to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   use the the ephemeral DHE keys.</td><td> </td><td class="right">   use the the ephemeral DHE keys.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Peers SHOULD validate each other's public key Y (dh_Ys offered by the</td><td> </td><td class="right">   Peers SHOULD validate each other's public key Y (dh_Ys offered by the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   server or DH_Yc offered by the client) by ensuring that 1 &lt; Y &lt; p-1.</td><td> </td><td class="right">   server or DH_Yc offered by the client) by ensuring that 1 &lt; Y &lt; p-1.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l30" /><small>skipping to change at</small><em> page 87, line 42</em></th><th> </th><th><a name="part-r30" /><small>skipping to change at</small><em> page 88, line 37</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">F.1.3.  Detecting Attacks Against the Handshake Protocol</td><td> </td><td class="right">F.1.3.  Detecting Attacks Against the Handshake Protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   An attacker might try to influence the handshake exchange to make the</td><td> </td><td class="right">   An attacker might try to influence the handshake exchange to make the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   parties select different encryption algorithms than they would</td><td> </td><td class="right">   parties select different encryption algorithms than they would</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   normally choose.</td><td> </td><td class="right">   normally choose.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   For this attack, an attacker must actively change one or more</td><td> </td><td class="right">   For this attack, an attacker must actively change one or more</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   handshake messages.  If this occurs, the client and server will</td><td> </td><td class="right">   handshake messages.  If this occurs, the client and server will</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   compute different values for the handshake message hashes.  As a</td><td> </td><td class="right">   compute different values for the handshake message hashes.  As a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   result, the parties will not accept each others' Finished messages.</td><td> </td><td class="right">   result, the parties will not accept each others' Finished messages.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0131" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Without the master<span class="delete">_</span>secret, the attacker cannot repair the Finished</td><td> </td><td class="rblock">   Without the master<span class="insert"> </span>secret, the attacker cannot repair the Finished</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   messages, so the attack will be discovered.</td><td> </td><td class="right">   messages, so the attack will be discovered.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">F.1.4.  Resuming Sessions</td><td> </td><td class="right">F.1.4.  Resuming Sessions</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   When a connection is established by resuming a session, new</td><td> </td><td class="right">   When a connection is established by resuming a session, new</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ClientHello.random and ServerHello.random values are hashed with the</td><td> </td><td class="right">   ClientHello.random and ServerHello.random values are hashed with the</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0132" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   session's master<span class="delete">_secret.  Provided that the master_</span>secret has not</td><td> </td><td class="rblock">   session's master<span class="insert"> secret.  Provided that the master </span>secret has not</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   been compromised and that the secure hash operations used to produce</td><td> </td><td class="right">   been compromised and that the secure hash operations used to produce</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the record protection kayes are secure, the connection should be</td><td> </td><td class="right">   the record protection kayes are secure, the connection should be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   secure and effectively independent from previous connections.</td><td> </td><td class="right">   secure and effectively independent from previous connections.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0133" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">   Attackers cannot use known keys to compromise the <span class="insert">master secret</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Attackers cannot use known keys to compromise the <span class="delete">master_secret</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   without breaking the secure hash operations.</td><td> </td><td class="right">   without breaking the secure hash operations.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Sessions cannot be resumed unless both the client and server agree.</td><td> </td><td class="right">   Sessions cannot be resumed unless both the client and server agree.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   If either party suspects that the session may have been compromised,</td><td> </td><td class="right">   If either party suspects that the session may have been compromised,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   or that certificates may have expired or been revoked, it should</td><td> </td><td class="right">   or that certificates may have expired or been revoked, it should</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   force a full handshake.  An upper limit of 24 hours is suggested for</td><td> </td><td class="right">   force a full handshake.  An upper limit of 24 hours is suggested for</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0134" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   session ID lifetimes, since an attacker who obtains a master<span class="delete">_</span>secret</td><td> </td><td class="rblock">   session ID lifetimes, since an attacker who obtains a master<span class="insert"> </span>secret</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   may be able to impersonate the compromised party until the</td><td> </td><td class="right">   may be able to impersonate the compromised party until the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   corresponding session ID is retired.  Applications that may be run in</td><td> </td><td class="right">   corresponding session ID is retired.  Applications that may be run in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   relatively insecure environments should not write session IDs to</td><td> </td><td class="right">   relatively insecure environments should not write session IDs to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   stable storage.</td><td> </td><td class="right">   stable storage.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">F.2.  Protecting Application Data</td><td> </td><td class="right">F.2.  Protecting Application Data</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0135" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   The master<span class="delete">_</span>secret is hashed with the ClientHello.random and</td><td> </td><td class="rblock">   The master<span class="insert"> </span>secret is hashed with the ClientHello.random and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   ServerHello.random to produce unique record protection secrets for</td><td> </td><td class="right">   ServerHello.random to produce unique record protection secrets for</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   each connection.</td><td> </td><td class="right">   each connection.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Outgoing data is protected using an AEAD algorithm before</td><td> </td><td class="right">   Outgoing data is protected using an AEAD algorithm before</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   transmission.  The authentication data includes the sequence number,</td><td> </td><td class="right">   transmission.  The authentication data includes the sequence number,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   message type, message length, and the message contents.  The message</td><td> </td><td class="right">   message type, message length, and the message contents.  The message</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   type field is necessary to ensure that messages intended for one TLS</td><td> </td><td class="right">   type field is necessary to ensure that messages intended for one TLS</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   record layer client are not redirected to another.  The sequence</td><td> </td><td class="right">   record layer client are not redirected to another.  The sequence</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   number ensures that attempts to delete or reorder messages will be</td><td> </td><td class="right">   number ensures that attempts to delete or reorder messages will be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   detected.  Since sequence numbers are 64 bits long, they should never</td><td> </td><td class="right">   detected.  Since sequence numbers are 64 bits long, they should never</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 135 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>429 lines changed or deleted</i></th><th><i> </i></th><th><i>499 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.34. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
